2026-01-27T15:17:29.106+01:00  INFO 7724 --- [Api Gateway] [restartedMain] h.f.e.gateway.ApiGatewayApplication      : Starting ApiGatewayApplication using Java 21.0.8 with PID 7724 (C:\DiplProj\ecommerce-microservices-project\gateway\target\classes started by K76 in C:\DiplProj\ecommerce-microservices-project\gateway)
2026-01-27T15:17:29.109+01:00  INFO 7724 --- [Api Gateway] [restartedMain] h.f.e.gateway.ApiGatewayApplication      : No active profile set, falling back to 1 default profile: "default"
2026-01-27T15:17:29.142+01:00  INFO 7724 --- [Api Gateway] [restartedMain] .e.DevToolsPropertyDefaultsPostProcessor : Devtools property defaults active! Set 'spring.devtools.add-properties' to 'false' to disable
2026-01-27T15:17:29.143+01:00  INFO 7724 --- [Api Gateway] [restartedMain] .e.DevToolsPropertyDefaultsPostProcessor : For additional web related logging consider setting the 'logging.level.web' property to 'DEBUG'
2026-01-27T15:17:29.725+01:00  INFO 7724 --- [Api Gateway] [restartedMain] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2026-01-27T15:17:29.785+01:00  INFO 7724 --- [Api Gateway] [restartedMain] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 25 ms. Found 0 JPA repository interfaces.
2026-01-27T15:17:30.374+01:00  INFO 7724 --- [Api Gateway] [restartedMain] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port 8080 (http)
2026-01-27T15:17:30.389+01:00  INFO 7724 --- [Api Gateway] [restartedMain] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2026-01-27T15:17:30.389+01:00  INFO 7724 --- [Api Gateway] [restartedMain] o.apache.catalina.core.StandardEngine    : Starting Servlet engine: [Apache Tomcat/10.1.48]
2026-01-27T15:17:30.421+01:00  INFO 7724 --- [Api Gateway] [restartedMain] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2026-01-27T15:17:30.421+01:00  INFO 7724 --- [Api Gateway] [restartedMain] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 1277 ms
2026-01-27T15:17:30.592+01:00  INFO 7724 --- [Api Gateway] [restartedMain] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Starting...
2026-01-27T15:17:30.748+01:00  INFO 7724 --- [Api Gateway] [restartedMain] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Added connection conn0: url=jdbc:h2:mem:f58518db-0605-4f5d-bb22-ed0cad7d75e0 user=SA
2026-01-27T15:17:30.748+01:00  INFO 7724 --- [Api Gateway] [restartedMain] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Start completed.
2026-01-27T15:17:30.873+01:00  INFO 7724 --- [Api Gateway] [restartedMain] org.flywaydb.core.FlywayExecutor         : Database: jdbc:h2:mem:f58518db-0605-4f5d-bb22-ed0cad7d75e0 (H2 2.3)
2026-01-27T15:17:30.944+01:00  INFO 7724 --- [Api Gateway] [restartedMain] o.f.c.i.s.JdbcTableSchemaHistory         : Schema history table "PUBLIC"."flyway_schema_history" does not exist yet
2026-01-27T15:17:30.944+01:00  INFO 7724 --- [Api Gateway] [restartedMain] o.f.core.internal.command.DbValidate     : Successfully validated 0 migrations (execution time 00:00.014s)
2026-01-27T15:17:30.944+01:00  WARN 7724 --- [Api Gateway] [restartedMain] o.f.core.internal.command.DbValidate     : No migrations found. Are your locations set up correctly?
2026-01-27T15:17:30.960+01:00  INFO 7724 --- [Api Gateway] [restartedMain] o.f.c.i.s.JdbcTableSchemaHistory         : Creating Schema History table "PUBLIC"."flyway_schema_history" ...
2026-01-27T15:17:30.975+01:00  INFO 7724 --- [Api Gateway] [restartedMain] o.f.core.internal.command.DbMigrate      : Current version of schema "PUBLIC": << Empty Schema >>
2026-01-27T15:17:30.994+01:00  INFO 7724 --- [Api Gateway] [restartedMain] o.f.core.internal.command.DbMigrate      : Schema "PUBLIC" is up to date. No migration necessary.
2026-01-27T15:17:31.046+01:00  INFO 7724 --- [Api Gateway] [restartedMain] o.hibernate.jpa.internal.util.LogHelper  : HHH000204: Processing PersistenceUnitInfo [name: default]
2026-01-27T15:17:31.096+01:00  INFO 7724 --- [Api Gateway] [restartedMain] org.hibernate.Version                    : HHH000412: Hibernate ORM core version 6.6.33.Final
2026-01-27T15:17:31.128+01:00  INFO 7724 --- [Api Gateway] [restartedMain] o.h.c.internal.RegionFactoryInitiator    : HHH000026: Second-level cache disabled
2026-01-27T15:17:31.513+01:00  INFO 7724 --- [Api Gateway] [restartedMain] o.s.o.j.p.SpringPersistenceUnitInfo      : No LoadTimeWeaver setup: ignoring JPA class transformer
2026-01-27T15:17:31.568+01:00  INFO 7724 --- [Api Gateway] [restartedMain] org.hibernate.orm.connections.pooling    : HHH10001005: Database info:
	Database JDBC URL [Connecting through datasource 'HikariDataSource (HikariPool-1)']
	Database driver: undefined/unknown
	Database version: 2.3.232
	Autocommit mode: undefined/unknown
	Isolation level: undefined/unknown
	Minimum pool size: undefined/unknown
	Maximum pool size: undefined/unknown
2026-01-27T15:17:31.804+01:00  INFO 7724 --- [Api Gateway] [restartedMain] o.h.e.t.j.p.i.JtaPlatformInitiator       : HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2026-01-27T15:17:31.808+01:00  INFO 7724 --- [Api Gateway] [restartedMain] j.LocalContainerEntityManagerFactoryBean : Initialized JPA EntityManagerFactory for persistence unit 'default'
2026-01-27T15:17:31.905+01:00  WARN 7724 --- [Api Gateway] [restartedMain] JpaBaseConfiguration$JpaWebConfiguration : spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2026-01-27T15:17:32.234+01:00  INFO 7724 --- [Api Gateway] [restartedMain] o.s.b.a.h2.H2ConsoleAutoConfiguration    : H2 console available at '/h2-console'. Database available at 'jdbc:h2:mem:f58518db-0605-4f5d-bb22-ed0cad7d75e0'
2026-01-27T15:17:32.295+01:00  WARN 7724 --- [Api Gateway] [restartedMain] o.s.b.d.a.OptionalLiveReloadServer       : Unable to start LiveReload server
2026-01-27T15:17:32.370+01:00  INFO 7724 --- [Api Gateway] [restartedMain] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port 8080 (http) with context path '/'
2026-01-27T15:17:32.377+01:00  INFO 7724 --- [Api Gateway] [restartedMain] h.f.e.gateway.ApiGatewayApplication      : Started ApiGatewayApplication in 3.661 seconds (process running for 4.003)
2026-01-27T15:17:48.168+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-1] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring DispatcherServlet 'dispatcherServlet'
2026-01-27T15:17:48.168+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-1] o.s.web.servlet.DispatcherServlet        : Initializing Servlet 'dispatcherServlet'
2026-01-27T15:17:48.168+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-1] o.s.web.servlet.DispatcherServlet        : Completed initialization in 0 ms
2026-01-27T15:17:48.318+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-1] h.f.e.g.controller.GatewayController     : Received place order request for customer: john.doe@example.com
2026-01-27T15:17:48.318+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-1] h.f.e.gateway.service.SagaService        : Starting order placement for customer: john.doe@example.com
2026-01-27T15:17:48.318+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-1] h.f.e.gateway.service.SagaService        : Step 1: Creating order...
2026-01-27T15:17:48.318+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-1] h.f.e.gateway.client.MicroserviceClient  : Creating order at: http://localhost:8082/api/orders
2026-01-27T15:17:48.401+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-1] h.f.e.gateway.client.MicroserviceClient  : Order created successfully with ID: 13
2026-01-27T15:17:48.401+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-1] h.f.e.gateway.service.SagaService        : Order created with ID: 13
2026-01-27T15:17:48.401+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-1] h.f.e.gateway.service.SagaService        : Step 2: Processing payment...
2026-01-27T15:17:48.401+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-1] h.f.e.gateway.client.MicroserviceClient  : Creating payment at: http://localhost:8084/api/payments
2026-01-27T15:17:48.435+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-1] h.f.e.gateway.client.MicroserviceClient  : Payment created successfully with ID: 36
2026-01-27T15:17:48.435+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-1] h.f.e.gateway.service.SagaService        : Payment created with ID: 36 and transaction ID: TXN-db121631-ee31-4178-be50-175723547e4b
2026-01-27T15:17:48.435+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-1] h.f.e.gateway.service.SagaService        : Step 3: Creating shipment...
2026-01-27T15:17:48.435+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-1] h.f.e.gateway.client.MicroserviceClient  : Creating shipment at: http://localhost:8083/api/shipments
2026-01-27T15:17:48.464+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-1] h.f.e.gateway.client.MicroserviceClient  : Shipment created successfully with ID: 35
2026-01-27T15:17:48.464+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-1] h.f.e.gateway.service.SagaService        : Shipment created with ID: 35
2026-01-27T15:17:48.465+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-1] h.f.e.gateway.service.SagaService        : Order placement completed successfully for order ID: 13
2026-01-27T15:17:48.465+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-1] h.f.e.g.controller.GatewayController     : GATEWAY | SAGA | totalDuration=146 ms | success=true
2026-01-27T15:17:50.324+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-2] h.f.e.g.controller.GatewayController     : Received 2PC place order request for customer: john.doe@example.com
2026-01-27T15:17:50.324+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-2] h.f.e.g.service.TwoPhaseCommitService    : Starting 2PC for customer: john.doe@example.com
2026-01-27T15:17:50.333+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-2] h.f.e.g.service.TwoPhaseCommitService    : PHASE 1: PREPARE
2026-01-27T15:17:50.338+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-2] h.f.e.g.service.TwoPhaseCommitService    : Preparing order and reserving stock
2026-01-27T15:17:50.338+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-2] h.f.e.gateway.client.MicroserviceClient  : 2PC: Preparing order at: http://localhost:8082/api/orders/prepare
2026-01-27T15:17:50.440+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-2] h.f.e.gateway.client.MicroserviceClient  : 2PC: Order prepared with ID: 14
2026-01-27T15:17:50.440+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-2] h.f.e.g.service.TwoPhaseCommitService    : Order prepared: ID=14, status=PREPARED
2026-01-27T15:17:50.440+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-2] h.f.e.g.service.TwoPhaseCommitService    : Pre-authorizing payment
2026-01-27T15:17:50.440+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-2] h.f.e.gateway.client.MicroserviceClient  : 2PC: Preparing payment at: http://localhost:8084/api/payments/prepare
2026-01-27T15:17:50.482+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-2] h.f.e.gateway.client.MicroserviceClient  : 2PC: Payment prepared with ID: 37
2026-01-27T15:17:50.488+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-2] h.f.e.g.service.TwoPhaseCommitService    : Payment prepared: ID=37, status=PRE_AUTHORIZED
2026-01-27T15:17:50.490+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-2] h.f.e.g.service.TwoPhaseCommitService    : Reserving shipment capacity
2026-01-27T15:17:50.490+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-2] h.f.e.gateway.client.MicroserviceClient  : 2PC: Preparing shipment at: http://localhost:8083/api/shipments/prepare
2026-01-27T15:17:50.536+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-2] h.f.e.gateway.client.MicroserviceClient  : 2PC: Shipment prepared with ID: 36
2026-01-27T15:17:50.537+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-2] h.f.e.g.service.TwoPhaseCommitService    : Shipment prepared: ID=36, status=RESERVED
2026-01-27T15:17:50.539+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-2] h.f.e.g.service.TwoPhaseCommitService    : Prepare phase completed - all resources reserved
2026-01-27T15:17:50.540+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-2] h.f.e.g.service.TwoPhaseCommitService    : All participants voted READY
2026-01-27T15:17:50.540+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-2] h.f.e.g.service.TwoPhaseCommitService    : PHASE 2: COMMIT
2026-01-27T15:17:50.541+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-2] h.f.e.g.service.TwoPhaseCommitService    : Committing order
2026-01-27T15:17:50.541+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-2] h.f.e.gateway.client.MicroserviceClient  : 2PC: Committing order at: http://localhost:8082/api/orders/14/commit
2026-01-27T15:17:50.557+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-2] h.f.e.gateway.client.MicroserviceClient  : 2PC: Order committed - ID: 14
2026-01-27T15:17:50.557+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-2] h.f.e.g.service.TwoPhaseCommitService    : Order committed: ID=14
2026-01-27T15:17:50.557+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-2] h.f.e.g.service.TwoPhaseCommitService    : Committing payment
2026-01-27T15:17:50.557+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-2] h.f.e.gateway.client.MicroserviceClient  : 2PC: Committing payment at: http://localhost:8084/api/payments/37/commit
2026-01-27T15:17:50.582+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-2] h.f.e.gateway.client.MicroserviceClient  : 2PC: Payment committed - ID: 37
2026-01-27T15:17:50.582+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-2] h.f.e.g.service.TwoPhaseCommitService    : Payment committed: ID=37
2026-01-27T15:17:50.582+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-2] h.f.e.g.service.TwoPhaseCommitService    : Committing shipment
2026-01-27T15:17:50.582+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-2] h.f.e.gateway.client.MicroserviceClient  : 2PC: Committing shipment at: http://localhost:8083/api/shipments/36/commit
2026-01-27T15:17:50.603+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-2] h.f.e.gateway.client.MicroserviceClient  : 2PC: Shipment committed - ID: 36
2026-01-27T15:17:50.604+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-2] h.f.e.g.service.TwoPhaseCommitService    : Shipment committed: ID=36
2026-01-27T15:17:50.608+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-2] h.f.e.g.service.TwoPhaseCommitService    : Commit phase completed
2026-01-27T15:17:50.608+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-2] h.f.e.g.service.TwoPhaseCommitService    : 2PC completed successfully - Order ID: 14
2026-01-27T15:17:50.608+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-2] h.f.e.g.controller.GatewayController     : GATEWAY | 2PC | totalDuration=283 ms | success=true
2026-01-27T15:59:46.039+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-5] h.f.e.g.controller.GatewayController     : Received place order request for customer: john.doe@example.com
2026-01-27T15:59:46.039+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-5] h.f.e.gateway.service.SagaService        : Starting order placement for customer: john.doe@example.com
2026-01-27T15:59:46.048+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-5] h.f.e.gateway.service.SagaService        : Step 1: Creating order...
2026-01-27T15:59:46.048+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-5] h.f.e.gateway.client.MicroserviceClient  : Creating order at: http://localhost:8082/api/orders
2026-01-27T15:59:46.628+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-5] h.f.e.gateway.client.MicroserviceClient  : Order created successfully with ID: 6
2026-01-27T15:59:46.628+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-5] h.f.e.gateway.service.SagaService        : Order created with ID: 6
2026-01-27T15:59:46.644+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-5] h.f.e.gateway.service.SagaService        : Step 2: Processing payment...
2026-01-27T15:59:46.644+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-5] h.f.e.gateway.client.MicroserviceClient  : Creating payment at: http://localhost:8084/api/payments
2026-01-27T15:59:47.201+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-5] h.f.e.gateway.client.MicroserviceClient  : Payment created successfully with ID: 38
2026-01-27T15:59:47.201+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-5] h.f.e.gateway.service.SagaService        : Payment created with ID: 38 and transaction ID: TXN-4c49a073-27c2-4325-8994-473021d5582c
2026-01-27T15:59:47.201+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-5] h.f.e.gateway.service.SagaService        : Step 3: Creating shipment...
2026-01-27T15:59:47.201+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-5] h.f.e.gateway.client.MicroserviceClient  : Creating shipment at: http://localhost:8083/api/shipments
2026-01-27T15:59:47.706+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-5] h.f.e.gateway.client.MicroserviceClient  : Shipment created successfully with ID: 37
2026-01-27T15:59:47.707+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-5] h.f.e.gateway.service.SagaService        : Shipment created with ID: 37
2026-01-27T15:59:47.708+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-5] h.f.e.gateway.service.SagaService        : Order placement completed successfully for order ID: 6
2026-01-27T15:59:47.710+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-5] h.f.e.g.controller.GatewayController     : GATEWAY | SAGA | totalDuration=1663 ms | success=true
2026-01-27T16:01:17.402+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-7] h.f.e.g.controller.GatewayController     : Received place order request for customer: john.doe@example.com
2026-01-27T16:01:17.403+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-7] h.f.e.gateway.service.SagaService        : Starting order placement for customer: john.doe@example.com
2026-01-27T16:01:17.406+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-7] h.f.e.gateway.service.SagaService        : Step 1: Creating order...
2026-01-27T16:01:17.406+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-7] h.f.e.gateway.client.MicroserviceClient  : Creating order at: http://localhost:8082/api/orders
2026-01-27T16:01:17.961+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-7] h.f.e.gateway.client.MicroserviceClient  : Order created successfully with ID: 6
2026-01-27T16:01:17.976+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-7] h.f.e.gateway.service.SagaService        : Order created with ID: 6
2026-01-27T16:01:17.976+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-7] h.f.e.gateway.service.SagaService        : Step 2: Processing payment...
2026-01-27T16:01:17.976+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-7] h.f.e.gateway.client.MicroserviceClient  : Creating payment at: http://localhost:8084/api/payments
2026-01-27T16:01:18.044+01:00 ERROR 7724 --- [Api Gateway] [http-nio-8080-exec-7] h.f.e.gateway.client.MicroserviceClient  : Error creating payment: 500  on POST request for "http://localhost:8084/api/payments": "{"status":500,"message":"An unexpected error occurred: Payment already exists for order: 6","timestamp":"2026-01-27T16:01:18.0155312","path":"/api/payments"}"

org.springframework.web.client.HttpServerErrorException$InternalServerError: 500  on POST request for "http://localhost:8084/api/payments": "{"status":500,"message":"An unexpected error occurred: Payment already exists for order: 6","timestamp":"2026-01-27T16:01:18.0155312","path":"/api/payments"}"
	at org.springframework.web.client.HttpServerErrorException.create(HttpServerErrorException.java:102) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:189) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:147) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.client.RestTemplate.handleResponse(RestTemplate.java:953) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.client.RestTemplate.doExecute(RestTemplate.java:902) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.client.RestTemplate.execute(RestTemplate.java:801) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.client.RestTemplate.postForObject(RestTemplate.java:518) ~[spring-web-6.2.12.jar:6.2.12]
	at hr.fer.ecommerce.gateway.client.MicroserviceClient.createPayment(MicroserviceClient.java:44) ~[classes/:na]
	at hr.fer.ecommerce.gateway.service.SagaService.createPayment(SagaService.java:131) ~[classes/:na]
	at hr.fer.ecommerce.gateway.service.SagaService.placeOrder(SagaService.java:38) ~[classes/:na]
	at hr.fer.ecommerce.gateway.controller.GatewayController.placeOrder(GatewayController.java:35) ~[classes/:na]
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:580) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:360) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.validation.beanvalidation.MethodValidationInterceptor.invoke(MethodValidationInterceptor.java:172) ~[spring-context-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:728) ~[spring-aop-6.2.12.jar:6.2.12]
	at hr.fer.ecommerce.gateway.controller.GatewayController$$SpringCGLIB$$0.placeOrder(<generated>) ~[classes/:na]
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:580) ~[na:na]
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:258) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:191) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:991) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:896) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590) ~[tomcat-embed-core-10.1.48.jar:6.0]
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658) ~[tomcat-embed-core-10.1.48.jar:6.0]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51) ~[tomcat-embed-websocket-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.12.jar:6.2.12]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.12.jar:6.2.12]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.12.jar:6.2.12]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.12.jar:6.2.12]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:165) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:88) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:113) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:83) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:72) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:342) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:399) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:903) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1774) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:973) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:491) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at java.base/java.lang.Thread.run(Thread.java:1583) ~[na:na]

2026-01-27T16:01:18.046+01:00 ERROR 7724 --- [Api Gateway] [http-nio-8080-exec-7] h.f.e.gateway.service.SagaService        : Error during order placement: Failed to create payment: 500  on POST request for "http://localhost:8084/api/payments": "{"status":500,"message":"An unexpected error occurred: Payment already exists for order: 6","timestamp":"2026-01-27T16:01:18.0155312","path":"/api/payments"}"

java.lang.RuntimeException: Failed to create payment: 500  on POST request for "http://localhost:8084/api/payments": "{"status":500,"message":"An unexpected error occurred: Payment already exists for order: 6","timestamp":"2026-01-27T16:01:18.0155312","path":"/api/payments"}"
	at hr.fer.ecommerce.gateway.client.MicroserviceClient.createPayment(MicroserviceClient.java:49) ~[classes/:na]
	at hr.fer.ecommerce.gateway.service.SagaService.createPayment(SagaService.java:131) ~[classes/:na]
	at hr.fer.ecommerce.gateway.service.SagaService.placeOrder(SagaService.java:38) ~[classes/:na]
	at hr.fer.ecommerce.gateway.controller.GatewayController.placeOrder(GatewayController.java:35) ~[classes/:na]
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:580) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:360) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.validation.beanvalidation.MethodValidationInterceptor.invoke(MethodValidationInterceptor.java:172) ~[spring-context-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:728) ~[spring-aop-6.2.12.jar:6.2.12]
	at hr.fer.ecommerce.gateway.controller.GatewayController$$SpringCGLIB$$0.placeOrder(<generated>) ~[classes/:na]
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:580) ~[na:na]
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:258) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:191) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:991) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:896) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590) ~[tomcat-embed-core-10.1.48.jar:6.0]
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658) ~[tomcat-embed-core-10.1.48.jar:6.0]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51) ~[tomcat-embed-websocket-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.12.jar:6.2.12]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.12.jar:6.2.12]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.12.jar:6.2.12]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.12.jar:6.2.12]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:165) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:88) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:113) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:83) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:72) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:342) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:399) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:903) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1774) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:973) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:491) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at java.base/java.lang.Thread.run(Thread.java:1583) ~[na:na]
Caused by: org.springframework.web.client.HttpServerErrorException$InternalServerError: 500  on POST request for "http://localhost:8084/api/payments": "{"status":500,"message":"An unexpected error occurred: Payment already exists for order: 6","timestamp":"2026-01-27T16:01:18.0155312","path":"/api/payments"}"
	at org.springframework.web.client.HttpServerErrorException.create(HttpServerErrorException.java:102) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:189) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:147) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.client.RestTemplate.handleResponse(RestTemplate.java:953) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.client.RestTemplate.doExecute(RestTemplate.java:902) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.client.RestTemplate.execute(RestTemplate.java:801) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.client.RestTemplate.postForObject(RestTemplate.java:518) ~[spring-web-6.2.12.jar:6.2.12]
	at hr.fer.ecommerce.gateway.client.MicroserviceClient.createPayment(MicroserviceClient.java:44) ~[classes/:na]
	... 64 common frames omitted

2026-01-27T16:01:18.062+01:00  WARN 7724 --- [Api Gateway] [http-nio-8080-exec-7] h.f.e.gateway.client.MicroserviceClient  : Compensating order: cancelling order ID 6
2026-01-27T16:01:18.123+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-7] h.f.e.g.controller.GatewayController     : GATEWAY | SAGA | totalDuration=731 ms | success=false
2026-01-27T16:02:28.967+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-8] h.f.e.g.controller.GatewayController     : Received place order request for customer: john.doe@example.com
2026-01-27T16:02:28.983+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-8] h.f.e.gateway.service.SagaService        : Starting order placement for customer: john.doe@example.com
2026-01-27T16:02:28.983+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-8] h.f.e.gateway.service.SagaService        : Step 1: Creating order...
2026-01-27T16:02:28.983+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-8] h.f.e.gateway.client.MicroserviceClient  : Creating order at: http://localhost:8082/api/orders
2026-01-27T16:02:29.233+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-8] h.f.e.gateway.client.MicroserviceClient  : Order created successfully with ID: 7
2026-01-27T16:02:29.233+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-8] h.f.e.gateway.service.SagaService        : Order created with ID: 7
2026-01-27T16:02:29.233+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-8] h.f.e.gateway.service.SagaService        : Step 2: Processing payment...
2026-01-27T16:02:29.233+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-8] h.f.e.gateway.client.MicroserviceClient  : Creating payment at: http://localhost:8084/api/payments
2026-01-27T16:02:29.300+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-8] h.f.e.gateway.client.MicroserviceClient  : Payment created successfully with ID: 39
2026-01-27T16:02:29.300+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-8] h.f.e.gateway.service.SagaService        : Payment created with ID: 39 and transaction ID: TXN-ffdaba77-2501-46c0-958d-5a3e7489fde7
2026-01-27T16:02:29.300+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-8] h.f.e.gateway.service.SagaService        : Step 3: Creating shipment...
2026-01-27T16:02:29.300+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-8] h.f.e.gateway.client.MicroserviceClient  : Creating shipment at: http://localhost:8083/api/shipments
2026-01-27T16:02:29.329+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-8] h.f.e.gateway.client.MicroserviceClient  : Shipment created successfully with ID: 38
2026-01-27T16:02:29.329+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-8] h.f.e.gateway.service.SagaService        : Shipment created with ID: 38
2026-01-27T16:02:29.329+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-8] h.f.e.gateway.service.SagaService        : Order placement completed successfully for order ID: 7
2026-01-27T16:02:29.329+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-8] h.f.e.g.controller.GatewayController     : GATEWAY | SAGA | totalDuration=348 ms | success=true
2026-01-27T16:04:25.437+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-10] h.f.e.g.controller.GatewayController     : Received place order request for customer: john.doe@example.com
2026-01-27T16:04:25.438+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-10] h.f.e.gateway.service.SagaService        : Starting order placement for customer: john.doe@example.com
2026-01-27T16:04:25.439+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-10] h.f.e.gateway.service.SagaService        : Step 1: Creating order...
2026-01-27T16:04:25.439+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-10] h.f.e.gateway.client.MicroserviceClient  : Creating order at: http://localhost:8082/api/orders
2026-01-27T16:04:25.871+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-10] h.f.e.gateway.client.MicroserviceClient  : Order created successfully with ID: 6
2026-01-27T16:04:25.871+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-10] h.f.e.gateway.service.SagaService        : Order created with ID: 6
2026-01-27T16:04:25.871+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-10] h.f.e.gateway.service.SagaService        : Step 2: Processing payment...
2026-01-27T16:04:25.871+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-10] h.f.e.gateway.client.MicroserviceClient  : Creating payment at: http://localhost:8084/api/payments
2026-01-27T16:04:25.987+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-10] h.f.e.gateway.client.MicroserviceClient  : Payment created successfully with ID: 40
2026-01-27T16:04:25.987+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-10] h.f.e.gateway.service.SagaService        : Payment created with ID: 40 and transaction ID: TXN-0eb184b6-4790-490f-8651-55947bd4c98a
2026-01-27T16:04:26.014+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-10] h.f.e.gateway.service.SagaService        : Step 3: Creating shipment...
2026-01-27T16:04:26.024+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-10] h.f.e.gateway.client.MicroserviceClient  : Creating shipment at: http://localhost:8083/api/shipments
2026-01-27T16:04:26.143+01:00 ERROR 7724 --- [Api Gateway] [http-nio-8080-exec-10] h.f.e.gateway.client.MicroserviceClient  : Error creating shipment: 500  on POST request for "http://localhost:8083/api/shipments": "{"status":500,"message":"An unexpected error occurred: Shipment already exists for order: 6","timestamp":"2026-01-27T16:04:26.1434","path":"/api/shipments"}"

org.springframework.web.client.HttpServerErrorException$InternalServerError: 500  on POST request for "http://localhost:8083/api/shipments": "{"status":500,"message":"An unexpected error occurred: Shipment already exists for order: 6","timestamp":"2026-01-27T16:04:26.1434","path":"/api/shipments"}"
	at org.springframework.web.client.HttpServerErrorException.create(HttpServerErrorException.java:102) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:189) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:147) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.client.RestTemplate.handleResponse(RestTemplate.java:953) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.client.RestTemplate.doExecute(RestTemplate.java:902) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.client.RestTemplate.execute(RestTemplate.java:801) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.client.RestTemplate.postForObject(RestTemplate.java:518) ~[spring-web-6.2.12.jar:6.2.12]
	at hr.fer.ecommerce.gateway.client.MicroserviceClient.createShipment(MicroserviceClient.java:58) ~[classes/:na]
	at hr.fer.ecommerce.gateway.service.SagaService.createShipment(SagaService.java:141) ~[classes/:na]
	at hr.fer.ecommerce.gateway.service.SagaService.placeOrder(SagaService.java:43) ~[classes/:na]
	at hr.fer.ecommerce.gateway.controller.GatewayController.placeOrder(GatewayController.java:35) ~[classes/:na]
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:580) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:360) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.validation.beanvalidation.MethodValidationInterceptor.invoke(MethodValidationInterceptor.java:172) ~[spring-context-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:728) ~[spring-aop-6.2.12.jar:6.2.12]
	at hr.fer.ecommerce.gateway.controller.GatewayController$$SpringCGLIB$$0.placeOrder(<generated>) ~[classes/:na]
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:580) ~[na:na]
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:258) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:191) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:991) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:896) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590) ~[tomcat-embed-core-10.1.48.jar:6.0]
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658) ~[tomcat-embed-core-10.1.48.jar:6.0]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51) ~[tomcat-embed-websocket-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.12.jar:6.2.12]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.12.jar:6.2.12]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.12.jar:6.2.12]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.12.jar:6.2.12]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:165) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:88) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:113) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:83) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:72) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:342) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:399) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:903) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1774) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:973) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:491) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at java.base/java.lang.Thread.run(Thread.java:1583) ~[na:na]

2026-01-27T16:04:26.143+01:00 ERROR 7724 --- [Api Gateway] [http-nio-8080-exec-10] h.f.e.gateway.service.SagaService        : Error during order placement: Failed to create shipment: 500  on POST request for "http://localhost:8083/api/shipments": "{"status":500,"message":"An unexpected error occurred: Shipment already exists for order: 6","timestamp":"2026-01-27T16:04:26.1434","path":"/api/shipments"}"

java.lang.RuntimeException: Failed to create shipment: 500  on POST request for "http://localhost:8083/api/shipments": "{"status":500,"message":"An unexpected error occurred: Shipment already exists for order: 6","timestamp":"2026-01-27T16:04:26.1434","path":"/api/shipments"}"
	at hr.fer.ecommerce.gateway.client.MicroserviceClient.createShipment(MicroserviceClient.java:63) ~[classes/:na]
	at hr.fer.ecommerce.gateway.service.SagaService.createShipment(SagaService.java:141) ~[classes/:na]
	at hr.fer.ecommerce.gateway.service.SagaService.placeOrder(SagaService.java:43) ~[classes/:na]
	at hr.fer.ecommerce.gateway.controller.GatewayController.placeOrder(GatewayController.java:35) ~[classes/:na]
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:580) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:360) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.validation.beanvalidation.MethodValidationInterceptor.invoke(MethodValidationInterceptor.java:172) ~[spring-context-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:728) ~[spring-aop-6.2.12.jar:6.2.12]
	at hr.fer.ecommerce.gateway.controller.GatewayController$$SpringCGLIB$$0.placeOrder(<generated>) ~[classes/:na]
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:580) ~[na:na]
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:258) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:191) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:991) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:896) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590) ~[tomcat-embed-core-10.1.48.jar:6.0]
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658) ~[tomcat-embed-core-10.1.48.jar:6.0]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51) ~[tomcat-embed-websocket-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.12.jar:6.2.12]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.12.jar:6.2.12]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.12.jar:6.2.12]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.12.jar:6.2.12]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:165) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:88) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:113) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:83) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:72) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:342) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:399) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:903) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1774) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:973) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:491) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at java.base/java.lang.Thread.run(Thread.java:1583) ~[na:na]
Caused by: org.springframework.web.client.HttpServerErrorException$InternalServerError: 500  on POST request for "http://localhost:8083/api/shipments": "{"status":500,"message":"An unexpected error occurred: Shipment already exists for order: 6","timestamp":"2026-01-27T16:04:26.1434","path":"/api/shipments"}"
	at org.springframework.web.client.HttpServerErrorException.create(HttpServerErrorException.java:102) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:189) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:147) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.client.RestTemplate.handleResponse(RestTemplate.java:953) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.client.RestTemplate.doExecute(RestTemplate.java:902) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.client.RestTemplate.execute(RestTemplate.java:801) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.client.RestTemplate.postForObject(RestTemplate.java:518) ~[spring-web-6.2.12.jar:6.2.12]
	at hr.fer.ecommerce.gateway.client.MicroserviceClient.createShipment(MicroserviceClient.java:58) ~[classes/:na]
	... 64 common frames omitted

2026-01-27T16:04:26.159+01:00  WARN 7724 --- [Api Gateway] [http-nio-8080-exec-10] h.f.e.gateway.client.MicroserviceClient  : Compensating payment: refunding payment ID 40
2026-01-27T16:04:26.229+01:00  WARN 7724 --- [Api Gateway] [http-nio-8080-exec-10] h.f.e.gateway.client.MicroserviceClient  : Compensating order: cancelling order ID 6
2026-01-27T16:04:26.279+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-10] h.f.e.g.controller.GatewayController     : GATEWAY | SAGA | totalDuration=851 ms | success=false
2026-01-27T16:05:12.521+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-1] h.f.e.g.controller.GatewayController     : Received place order request for customer: john.doe@example.com
2026-01-27T16:05:12.521+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-1] h.f.e.gateway.service.SagaService        : Starting order placement for customer: john.doe@example.com
2026-01-27T16:05:12.529+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-1] h.f.e.gateway.service.SagaService        : Step 1: Creating order...
2026-01-27T16:05:12.538+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-1] h.f.e.gateway.client.MicroserviceClient  : Creating order at: http://localhost:8082/api/orders
2026-01-27T16:05:12.696+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-1] h.f.e.gateway.client.MicroserviceClient  : Order created successfully with ID: 7
2026-01-27T16:05:12.696+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-1] h.f.e.gateway.service.SagaService        : Order created with ID: 7
2026-01-27T16:05:12.704+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-1] h.f.e.gateway.service.SagaService        : Step 2: Processing payment...
2026-01-27T16:05:12.704+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-1] h.f.e.gateway.client.MicroserviceClient  : Creating payment at: http://localhost:8084/api/payments
2026-01-27T16:05:12.721+01:00 ERROR 7724 --- [Api Gateway] [http-nio-8080-exec-1] h.f.e.gateway.client.MicroserviceClient  : Error creating payment: 500  on POST request for "http://localhost:8084/api/payments": "{"status":500,"message":"An unexpected error occurred: Payment already exists for order: 7","timestamp":"2026-01-27T16:05:12.7216488","path":"/api/payments"}"

org.springframework.web.client.HttpServerErrorException$InternalServerError: 500  on POST request for "http://localhost:8084/api/payments": "{"status":500,"message":"An unexpected error occurred: Payment already exists for order: 7","timestamp":"2026-01-27T16:05:12.7216488","path":"/api/payments"}"
	at org.springframework.web.client.HttpServerErrorException.create(HttpServerErrorException.java:102) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:189) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:147) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.client.RestTemplate.handleResponse(RestTemplate.java:953) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.client.RestTemplate.doExecute(RestTemplate.java:902) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.client.RestTemplate.execute(RestTemplate.java:801) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.client.RestTemplate.postForObject(RestTemplate.java:518) ~[spring-web-6.2.12.jar:6.2.12]
	at hr.fer.ecommerce.gateway.client.MicroserviceClient.createPayment(MicroserviceClient.java:44) ~[classes/:na]
	at hr.fer.ecommerce.gateway.service.SagaService.createPayment(SagaService.java:131) ~[classes/:na]
	at hr.fer.ecommerce.gateway.service.SagaService.placeOrder(SagaService.java:38) ~[classes/:na]
	at hr.fer.ecommerce.gateway.controller.GatewayController.placeOrder(GatewayController.java:35) ~[classes/:na]
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:580) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:360) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.validation.beanvalidation.MethodValidationInterceptor.invoke(MethodValidationInterceptor.java:172) ~[spring-context-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:728) ~[spring-aop-6.2.12.jar:6.2.12]
	at hr.fer.ecommerce.gateway.controller.GatewayController$$SpringCGLIB$$0.placeOrder(<generated>) ~[classes/:na]
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:580) ~[na:na]
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:258) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:191) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:991) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:896) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590) ~[tomcat-embed-core-10.1.48.jar:6.0]
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658) ~[tomcat-embed-core-10.1.48.jar:6.0]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51) ~[tomcat-embed-websocket-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.12.jar:6.2.12]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.12.jar:6.2.12]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.12.jar:6.2.12]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.12.jar:6.2.12]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:165) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:88) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:113) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:83) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:72) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:342) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:399) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:903) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1774) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:973) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:491) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at java.base/java.lang.Thread.run(Thread.java:1583) ~[na:na]

2026-01-27T16:05:12.721+01:00 ERROR 7724 --- [Api Gateway] [http-nio-8080-exec-1] h.f.e.gateway.service.SagaService        : Error during order placement: Failed to create payment: 500  on POST request for "http://localhost:8084/api/payments": "{"status":500,"message":"An unexpected error occurred: Payment already exists for order: 7","timestamp":"2026-01-27T16:05:12.7216488","path":"/api/payments"}"

java.lang.RuntimeException: Failed to create payment: 500  on POST request for "http://localhost:8084/api/payments": "{"status":500,"message":"An unexpected error occurred: Payment already exists for order: 7","timestamp":"2026-01-27T16:05:12.7216488","path":"/api/payments"}"
	at hr.fer.ecommerce.gateway.client.MicroserviceClient.createPayment(MicroserviceClient.java:49) ~[classes/:na]
	at hr.fer.ecommerce.gateway.service.SagaService.createPayment(SagaService.java:131) ~[classes/:na]
	at hr.fer.ecommerce.gateway.service.SagaService.placeOrder(SagaService.java:38) ~[classes/:na]
	at hr.fer.ecommerce.gateway.controller.GatewayController.placeOrder(GatewayController.java:35) ~[classes/:na]
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:580) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:360) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.validation.beanvalidation.MethodValidationInterceptor.invoke(MethodValidationInterceptor.java:172) ~[spring-context-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:728) ~[spring-aop-6.2.12.jar:6.2.12]
	at hr.fer.ecommerce.gateway.controller.GatewayController$$SpringCGLIB$$0.placeOrder(<generated>) ~[classes/:na]
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:580) ~[na:na]
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:258) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:191) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:991) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:896) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590) ~[tomcat-embed-core-10.1.48.jar:6.0]
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658) ~[tomcat-embed-core-10.1.48.jar:6.0]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51) ~[tomcat-embed-websocket-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.12.jar:6.2.12]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.12.jar:6.2.12]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.12.jar:6.2.12]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.12.jar:6.2.12]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:165) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:88) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:113) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:83) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:72) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:342) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:399) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:903) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1774) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:973) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:491) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at java.base/java.lang.Thread.run(Thread.java:1583) ~[na:na]
Caused by: org.springframework.web.client.HttpServerErrorException$InternalServerError: 500  on POST request for "http://localhost:8084/api/payments": "{"status":500,"message":"An unexpected error occurred: Payment already exists for order: 7","timestamp":"2026-01-27T16:05:12.7216488","path":"/api/payments"}"
	at org.springframework.web.client.HttpServerErrorException.create(HttpServerErrorException.java:102) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:189) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:147) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.client.RestTemplate.handleResponse(RestTemplate.java:953) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.client.RestTemplate.doExecute(RestTemplate.java:902) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.client.RestTemplate.execute(RestTemplate.java:801) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.client.RestTemplate.postForObject(RestTemplate.java:518) ~[spring-web-6.2.12.jar:6.2.12]
	at hr.fer.ecommerce.gateway.client.MicroserviceClient.createPayment(MicroserviceClient.java:44) ~[classes/:na]
	... 64 common frames omitted

2026-01-27T16:05:12.729+01:00  WARN 7724 --- [Api Gateway] [http-nio-8080-exec-1] h.f.e.gateway.client.MicroserviceClient  : Compensating order: cancelling order ID 7
2026-01-27T16:05:12.763+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-1] h.f.e.g.controller.GatewayController     : GATEWAY | SAGA | totalDuration=236 ms | success=false
2026-01-27T16:05:13.955+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-3] h.f.e.g.controller.GatewayController     : Received 2PC place order request for customer: john.doe@example.com
2026-01-27T16:05:13.955+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-3] h.f.e.g.service.TwoPhaseCommitService    : Starting 2PC for customer: john.doe@example.com
2026-01-27T16:05:13.955+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-3] h.f.e.g.service.TwoPhaseCommitService    : PHASE 1: PREPARE
2026-01-27T16:05:13.955+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-3] h.f.e.g.service.TwoPhaseCommitService    : Preparing order and reserving stock
2026-01-27T16:05:13.955+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-3] h.f.e.gateway.client.MicroserviceClient  : 2PC: Preparing order at: http://localhost:8082/api/orders/prepare
2026-01-27T16:05:14.123+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-3] h.f.e.gateway.client.MicroserviceClient  : 2PC: Order prepared with ID: 8
2026-01-27T16:05:14.123+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-3] h.f.e.g.service.TwoPhaseCommitService    : Order prepared: ID=8, status=PREPARED
2026-01-27T16:05:14.123+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-3] h.f.e.g.service.TwoPhaseCommitService    : Pre-authorizing payment
2026-01-27T16:05:14.131+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-3] h.f.e.gateway.client.MicroserviceClient  : 2PC: Preparing payment at: http://localhost:8084/api/payments/prepare
2026-01-27T16:05:14.163+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-3] h.f.e.gateway.client.MicroserviceClient  : 2PC: Payment prepared with ID: 41
2026-01-27T16:05:14.163+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-3] h.f.e.g.service.TwoPhaseCommitService    : Payment prepared: ID=41, status=PRE_AUTHORIZED
2026-01-27T16:05:14.163+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-3] h.f.e.g.service.TwoPhaseCommitService    : Reserving shipment capacity
2026-01-27T16:05:14.163+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-3] h.f.e.gateway.client.MicroserviceClient  : 2PC: Preparing shipment at: http://localhost:8083/api/shipments/prepare
2026-01-27T16:05:14.196+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-3] h.f.e.gateway.client.MicroserviceClient  : 2PC: Shipment prepared with ID: 39
2026-01-27T16:05:14.196+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-3] h.f.e.g.service.TwoPhaseCommitService    : Shipment prepared: ID=39, status=RESERVED
2026-01-27T16:05:14.196+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-3] h.f.e.g.service.TwoPhaseCommitService    : Prepare phase completed - all resources reserved
2026-01-27T16:05:14.196+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-3] h.f.e.g.service.TwoPhaseCommitService    : All participants voted READY
2026-01-27T16:05:14.196+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-3] h.f.e.g.service.TwoPhaseCommitService    : PHASE 2: COMMIT
2026-01-27T16:05:14.196+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-3] h.f.e.g.service.TwoPhaseCommitService    : Committing order
2026-01-27T16:05:14.196+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-3] h.f.e.gateway.client.MicroserviceClient  : 2PC: Committing order at: http://localhost:8082/api/orders/8/commit
2026-01-27T16:05:14.232+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-3] h.f.e.gateway.client.MicroserviceClient  : 2PC: Order committed - ID: 8
2026-01-27T16:05:14.232+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-3] h.f.e.g.service.TwoPhaseCommitService    : Order committed: ID=8
2026-01-27T16:05:14.233+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-3] h.f.e.g.service.TwoPhaseCommitService    : Committing payment
2026-01-27T16:05:14.233+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-3] h.f.e.gateway.client.MicroserviceClient  : 2PC: Committing payment at: http://localhost:8084/api/payments/41/commit
2026-01-27T16:05:14.246+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-3] h.f.e.gateway.client.MicroserviceClient  : 2PC: Payment committed - ID: 41
2026-01-27T16:05:14.246+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-3] h.f.e.g.service.TwoPhaseCommitService    : Payment committed: ID=41
2026-01-27T16:05:14.246+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-3] h.f.e.g.service.TwoPhaseCommitService    : Committing shipment
2026-01-27T16:05:14.246+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-3] h.f.e.gateway.client.MicroserviceClient  : 2PC: Committing shipment at: http://localhost:8083/api/shipments/39/commit
2026-01-27T16:05:14.268+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-3] h.f.e.gateway.client.MicroserviceClient  : 2PC: Shipment committed - ID: 39
2026-01-27T16:05:14.268+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-3] h.f.e.g.service.TwoPhaseCommitService    : Shipment committed: ID=39
2026-01-27T16:05:14.269+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-3] h.f.e.g.service.TwoPhaseCommitService    : Commit phase completed
2026-01-27T16:05:14.271+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-3] h.f.e.g.service.TwoPhaseCommitService    : 2PC completed successfully - Order ID: 8
2026-01-27T16:05:14.271+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-3] h.f.e.g.controller.GatewayController     : GATEWAY | 2PC | totalDuration=311 ms | success=true
2026-01-27T16:05:15.724+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-4] h.f.e.g.controller.GatewayController     : Received place order request for customer: john.doe@example.com
2026-01-27T16:05:15.725+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-4] h.f.e.gateway.service.SagaService        : Starting order placement for customer: john.doe@example.com
2026-01-27T16:05:15.725+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-4] h.f.e.gateway.service.SagaService        : Step 1: Creating order...
2026-01-27T16:05:15.725+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-4] h.f.e.gateway.client.MicroserviceClient  : Creating order at: http://localhost:8082/api/orders
2026-01-27T16:05:15.788+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-4] h.f.e.gateway.client.MicroserviceClient  : Order created successfully with ID: 9
2026-01-27T16:05:15.791+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-4] h.f.e.gateway.service.SagaService        : Order created with ID: 9
2026-01-27T16:05:15.792+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-4] h.f.e.gateway.service.SagaService        : Step 2: Processing payment...
2026-01-27T16:05:15.792+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-4] h.f.e.gateway.client.MicroserviceClient  : Creating payment at: http://localhost:8084/api/payments
2026-01-27T16:05:15.810+01:00 ERROR 7724 --- [Api Gateway] [http-nio-8080-exec-4] h.f.e.gateway.client.MicroserviceClient  : Error creating payment: 500  on POST request for "http://localhost:8084/api/payments": "{"status":500,"message":"An unexpected error occurred: Payment already exists for order: 9","timestamp":"2026-01-27T16:05:15.8065503","path":"/api/payments"}"

org.springframework.web.client.HttpServerErrorException$InternalServerError: 500  on POST request for "http://localhost:8084/api/payments": "{"status":500,"message":"An unexpected error occurred: Payment already exists for order: 9","timestamp":"2026-01-27T16:05:15.8065503","path":"/api/payments"}"
	at org.springframework.web.client.HttpServerErrorException.create(HttpServerErrorException.java:102) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:189) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:147) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.client.RestTemplate.handleResponse(RestTemplate.java:953) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.client.RestTemplate.doExecute(RestTemplate.java:902) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.client.RestTemplate.execute(RestTemplate.java:801) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.client.RestTemplate.postForObject(RestTemplate.java:518) ~[spring-web-6.2.12.jar:6.2.12]
	at hr.fer.ecommerce.gateway.client.MicroserviceClient.createPayment(MicroserviceClient.java:44) ~[classes/:na]
	at hr.fer.ecommerce.gateway.service.SagaService.createPayment(SagaService.java:131) ~[classes/:na]
	at hr.fer.ecommerce.gateway.service.SagaService.placeOrder(SagaService.java:38) ~[classes/:na]
	at hr.fer.ecommerce.gateway.controller.GatewayController.placeOrder(GatewayController.java:35) ~[classes/:na]
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:580) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:360) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.validation.beanvalidation.MethodValidationInterceptor.invoke(MethodValidationInterceptor.java:172) ~[spring-context-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:728) ~[spring-aop-6.2.12.jar:6.2.12]
	at hr.fer.ecommerce.gateway.controller.GatewayController$$SpringCGLIB$$0.placeOrder(<generated>) ~[classes/:na]
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:580) ~[na:na]
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:258) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:191) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:991) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:896) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590) ~[tomcat-embed-core-10.1.48.jar:6.0]
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658) ~[tomcat-embed-core-10.1.48.jar:6.0]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51) ~[tomcat-embed-websocket-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.12.jar:6.2.12]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.12.jar:6.2.12]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.12.jar:6.2.12]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.12.jar:6.2.12]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:165) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:88) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:113) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:83) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:72) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:342) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:399) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:903) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1774) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:973) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:491) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at java.base/java.lang.Thread.run(Thread.java:1583) ~[na:na]

2026-01-27T16:05:15.813+01:00 ERROR 7724 --- [Api Gateway] [http-nio-8080-exec-4] h.f.e.gateway.service.SagaService        : Error during order placement: Failed to create payment: 500  on POST request for "http://localhost:8084/api/payments": "{"status":500,"message":"An unexpected error occurred: Payment already exists for order: 9","timestamp":"2026-01-27T16:05:15.8065503","path":"/api/payments"}"

java.lang.RuntimeException: Failed to create payment: 500  on POST request for "http://localhost:8084/api/payments": "{"status":500,"message":"An unexpected error occurred: Payment already exists for order: 9","timestamp":"2026-01-27T16:05:15.8065503","path":"/api/payments"}"
	at hr.fer.ecommerce.gateway.client.MicroserviceClient.createPayment(MicroserviceClient.java:49) ~[classes/:na]
	at hr.fer.ecommerce.gateway.service.SagaService.createPayment(SagaService.java:131) ~[classes/:na]
	at hr.fer.ecommerce.gateway.service.SagaService.placeOrder(SagaService.java:38) ~[classes/:na]
	at hr.fer.ecommerce.gateway.controller.GatewayController.placeOrder(GatewayController.java:35) ~[classes/:na]
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:580) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:360) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.validation.beanvalidation.MethodValidationInterceptor.invoke(MethodValidationInterceptor.java:172) ~[spring-context-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:728) ~[spring-aop-6.2.12.jar:6.2.12]
	at hr.fer.ecommerce.gateway.controller.GatewayController$$SpringCGLIB$$0.placeOrder(<generated>) ~[classes/:na]
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:580) ~[na:na]
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:258) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:191) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:991) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:896) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590) ~[tomcat-embed-core-10.1.48.jar:6.0]
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658) ~[tomcat-embed-core-10.1.48.jar:6.0]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51) ~[tomcat-embed-websocket-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.12.jar:6.2.12]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.12.jar:6.2.12]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.12.jar:6.2.12]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.12.jar:6.2.12]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:165) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:88) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:113) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:83) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:72) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:342) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:399) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:903) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1774) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:973) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:491) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at java.base/java.lang.Thread.run(Thread.java:1583) ~[na:na]
Caused by: org.springframework.web.client.HttpServerErrorException$InternalServerError: 500  on POST request for "http://localhost:8084/api/payments": "{"status":500,"message":"An unexpected error occurred: Payment already exists for order: 9","timestamp":"2026-01-27T16:05:15.8065503","path":"/api/payments"}"
	at org.springframework.web.client.HttpServerErrorException.create(HttpServerErrorException.java:102) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:189) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:147) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.client.RestTemplate.handleResponse(RestTemplate.java:953) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.client.RestTemplate.doExecute(RestTemplate.java:902) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.client.RestTemplate.execute(RestTemplate.java:801) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.client.RestTemplate.postForObject(RestTemplate.java:518) ~[spring-web-6.2.12.jar:6.2.12]
	at hr.fer.ecommerce.gateway.client.MicroserviceClient.createPayment(MicroserviceClient.java:44) ~[classes/:na]
	... 64 common frames omitted

2026-01-27T16:05:15.817+01:00  WARN 7724 --- [Api Gateway] [http-nio-8080-exec-4] h.f.e.gateway.client.MicroserviceClient  : Compensating order: cancelling order ID 9
2026-01-27T16:05:15.859+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-4] h.f.e.g.controller.GatewayController     : GATEWAY | SAGA | totalDuration=136 ms | success=false
2026-01-27T16:05:17.322+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-5] h.f.e.g.controller.GatewayController     : Received 2PC place order request for customer: john.doe@example.com
2026-01-27T16:05:17.338+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-5] h.f.e.g.service.TwoPhaseCommitService    : Starting 2PC for customer: john.doe@example.com
2026-01-27T16:05:17.339+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-5] h.f.e.g.service.TwoPhaseCommitService    : PHASE 1: PREPARE
2026-01-27T16:05:17.339+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-5] h.f.e.g.service.TwoPhaseCommitService    : Preparing order and reserving stock
2026-01-27T16:05:17.339+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-5] h.f.e.gateway.client.MicroserviceClient  : 2PC: Preparing order at: http://localhost:8082/api/orders/prepare
2026-01-27T16:05:17.462+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-5] h.f.e.gateway.client.MicroserviceClient  : 2PC: Order prepared with ID: 10
2026-01-27T16:05:17.462+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-5] h.f.e.g.service.TwoPhaseCommitService    : Order prepared: ID=10, status=PREPARED
2026-01-27T16:05:17.476+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-5] h.f.e.g.service.TwoPhaseCommitService    : Pre-authorizing payment
2026-01-27T16:05:17.477+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-5] h.f.e.gateway.client.MicroserviceClient  : 2PC: Preparing payment at: http://localhost:8084/api/payments/prepare
2026-01-27T16:05:17.491+01:00 ERROR 7724 --- [Api Gateway] [http-nio-8080-exec-5] h.f.e.gateway.client.MicroserviceClient  : 2PC: Failed to prepare payment: 500  on POST request for "http://localhost:8084/api/payments/prepare": "{"status":500,"message":"An unexpected error occurred: could not execute statement [Unique index or primary key violation: \"PUBLIC.CONSTRAINT_INDEX_8 ON PUBLIC.PAYMENTS(ORDER_ID NULLS FIRST) VALUES ( /* 33 */ CAST(10 AS BIGINT) )\"; SQL statement:\ninsert into payments (card_last_four_digits,created_at,failure_reason,order_id,paid_amount,paid_customer_email,paid_customer_name,payment_method,payment_provider,processed_at,status,transaction_id,updated_at,version,id) values (?,?,?,?,?,?,?,?,?,?,?,?,?,?,default) [23505-232]] [insert into payments (card_last_four_digits,created_at,failure_reason,order_id,paid_amount,paid_customer_email,paid_customer_name,payment_method,payment_provider,processed_at,status,transaction_id,updated_at,version,id) values (?,?,?,?,?,?,?,?,?,?,?,?,?,?,default)]; SQL [insert into payments (card_last_four_digits,created_at,failure_reason,order_id,paid_amount,paid_customer_email,paid_customer_name,payment_method,payment_provider,processed_at,status,transaction_id,updated_at,version,id) values (?,?,?,?,?,?,?,?,?,?,?,?,?,?,default)]; constraint [PUBLIC.CONSTRAINT_INDEX_8]","timestamp":"2026-01-27T16:05:17.4917808","path":"/api/payments/prepare"}"

org.springframework.web.client.HttpServerErrorException$InternalServerError: 500  on POST request for "http://localhost:8084/api/payments/prepare": "{"status":500,"message":"An unexpected error occurred: could not execute statement [Unique index or primary key violation: \"PUBLIC.CONSTRAINT_INDEX_8 ON PUBLIC.PAYMENTS(ORDER_ID NULLS FIRST) VALUES ( /* 33 */ CAST(10 AS BIGINT) )\"; SQL statement:\ninsert into payments (card_last_four_digits,created_at,failure_reason,order_id,paid_amount,paid_customer_email,paid_customer_name,payment_method,payment_provider,processed_at,status,transaction_id,updated_at,version,id) values (?,?,?,?,?,?,?,?,?,?,?,?,?,?,default) [23505-232]] [insert into payments (card_last_four_digits,created_at,failure_reason,order_id,paid_amount,paid_customer_email,paid_customer_name,payment_method,payment_provider,processed_at,status,transaction_id,updated_at,version,id) values (?,?,?,?,?,?,?,?,?,?,?,?,?,?,default)]; SQL [insert into payments (card_last_four_digits,created_at,failure_reason,order_id,paid_amount,paid_customer_email,paid_customer_name,payment_method,payment_provider,processed_at,status,transaction_id,updated_at,version,id) values (?,?,?,?,?,?,?,?,?,?,?,?,?,?,default)]; constraint [PUBLIC.CONSTRAINT_INDEX_8]","timestamp":"2026-01-27T16:05:17.4917808","path":"/api/payments/prepare"}"
	at org.springframework.web.client.HttpServerErrorException.create(HttpServerErrorException.java:102) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:189) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:147) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.client.RestTemplate.handleResponse(RestTemplate.java:953) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.client.RestTemplate.doExecute(RestTemplate.java:902) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.client.RestTemplate.execute(RestTemplate.java:801) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.client.RestTemplate.postForObject(RestTemplate.java:518) ~[spring-web-6.2.12.jar:6.2.12]
	at hr.fer.ecommerce.gateway.client.MicroserviceClient.preparePayment(MicroserviceClient.java:150) ~[classes/:na]
	at hr.fer.ecommerce.gateway.service.TwoPhaseCommitService.preparePhase(TwoPhaseCommitService.java:79) ~[classes/:na]
	at hr.fer.ecommerce.gateway.service.TwoPhaseCommitService.placeOrderWith2PC(TwoPhaseCommitService.java:33) ~[classes/:na]
	at hr.fer.ecommerce.gateway.controller.GatewayController.placeOrderWith2PC(GatewayController.java:57) ~[classes/:na]
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:580) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:360) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.validation.beanvalidation.MethodValidationInterceptor.invoke(MethodValidationInterceptor.java:172) ~[spring-context-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:728) ~[spring-aop-6.2.12.jar:6.2.12]
	at hr.fer.ecommerce.gateway.controller.GatewayController$$SpringCGLIB$$0.placeOrderWith2PC(<generated>) ~[classes/:na]
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:580) ~[na:na]
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:258) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:191) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:991) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:896) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590) ~[tomcat-embed-core-10.1.48.jar:6.0]
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658) ~[tomcat-embed-core-10.1.48.jar:6.0]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51) ~[tomcat-embed-websocket-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.12.jar:6.2.12]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.12.jar:6.2.12]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.12.jar:6.2.12]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.12.jar:6.2.12]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:165) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:88) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:113) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:83) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:72) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:342) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:399) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:903) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1774) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:973) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:491) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at java.base/java.lang.Thread.run(Thread.java:1583) ~[na:na]

2026-01-27T16:05:17.491+01:00 ERROR 7724 --- [Api Gateway] [http-nio-8080-exec-5] h.f.e.g.service.TwoPhaseCommitService    : Prepare phase failed: Failed to prepare payment: 500  on POST request for "http://localhost:8084/api/payments/prepare": "{"status":500,"message":"An unexpected error occurred: could not execute statement [Unique index or primary key violation: \"PUBLIC.CONSTRAINT_INDEX_8 ON PUBLIC.PAYMENTS(ORDER_ID NULLS FIRST) VALUES ( /* 33 */ CAST(10 AS BIGINT) )\"; SQL statement:\ninsert into payments (card_last_four_digits,created_at,failure_reason,order_id,paid_amount,paid_customer_email,paid_customer_name,payment_method,payment_provider,processed_at,status,transaction_id,updated_at,version,id) values (?,?,?,?,?,?,?,?,?,?,?,?,?,?,default) [23505-232]] [insert into payments (card_last_four_digits,created_at,failure_reason,order_id,paid_amount,paid_customer_email,paid_customer_name,payment_method,payment_provider,processed_at,status,transaction_id,updated_at,version,id) values (?,?,?,?,?,?,?,?,?,?,?,?,?,?,default)]; SQL [insert into payments (card_last_four_digits,created_at,failure_reason,order_id,paid_amount,paid_customer_email,paid_customer_name,payment_method,payment_provider,processed_at,status,transaction_id,updated_at,version,id) values (?,?,?,?,?,?,?,?,?,?,?,?,?,?,default)]; constraint [PUBLIC.CONSTRAINT_INDEX_8]","timestamp":"2026-01-27T16:05:17.4917808","path":"/api/payments/prepare"}"
2026-01-27T16:05:17.491+01:00  WARN 7724 --- [Api Gateway] [http-nio-8080-exec-5] h.f.e.g.service.TwoPhaseCommitService    : Aborting transaction - releasing all prepared resources
2026-01-27T16:05:17.491+01:00  WARN 7724 --- [Api Gateway] [http-nio-8080-exec-5] h.f.e.g.service.TwoPhaseCommitService    : Aborting order: ID=10
2026-01-27T16:05:17.491+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-5] h.f.e.gateway.client.MicroserviceClient  : 2PC: Aborting order at: http://localhost:8082/api/orders/10/abort
2026-01-27T16:05:17.560+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-5] h.f.e.gateway.client.MicroserviceClient  : 2PC: Order aborted - ID: 10
2026-01-27T16:05:17.560+01:00  WARN 7724 --- [Api Gateway] [http-nio-8080-exec-5] h.f.e.g.service.TwoPhaseCommitService    : Order aborted
2026-01-27T16:05:17.560+01:00  WARN 7724 --- [Api Gateway] [http-nio-8080-exec-5] h.f.e.g.service.TwoPhaseCommitService    : Abort phase completed
2026-01-27T16:05:17.560+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-5] h.f.e.g.controller.GatewayController     : GATEWAY | 2PC | totalDuration=235 ms | success=false
2026-01-27T16:05:19.840+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-6] h.f.e.g.controller.GatewayController     : Received place order request for customer: john.doe@example.com
2026-01-27T16:05:19.840+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-6] h.f.e.gateway.service.SagaService        : Starting order placement for customer: john.doe@example.com
2026-01-27T16:05:19.840+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-6] h.f.e.gateway.service.SagaService        : Step 1: Creating order...
2026-01-27T16:05:19.840+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-6] h.f.e.gateway.client.MicroserviceClient  : Creating order at: http://localhost:8082/api/orders
2026-01-27T16:05:19.978+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-6] h.f.e.gateway.client.MicroserviceClient  : Order created successfully with ID: 11
2026-01-27T16:05:19.978+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-6] h.f.e.gateway.service.SagaService        : Order created with ID: 11
2026-01-27T16:05:19.978+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-6] h.f.e.gateway.service.SagaService        : Step 2: Processing payment...
2026-01-27T16:05:19.987+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-6] h.f.e.gateway.client.MicroserviceClient  : Creating payment at: http://localhost:8084/api/payments
2026-01-27T16:05:20.028+01:00 ERROR 7724 --- [Api Gateway] [http-nio-8080-exec-6] h.f.e.gateway.client.MicroserviceClient  : Error creating payment: 500  on POST request for "http://localhost:8084/api/payments": "{"status":500,"message":"An unexpected error occurred: Payment already exists for order: 11","timestamp":"2026-01-27T16:05:20.0203526","path":"/api/payments"}"

org.springframework.web.client.HttpServerErrorException$InternalServerError: 500  on POST request for "http://localhost:8084/api/payments": "{"status":500,"message":"An unexpected error occurred: Payment already exists for order: 11","timestamp":"2026-01-27T16:05:20.0203526","path":"/api/payments"}"
	at org.springframework.web.client.HttpServerErrorException.create(HttpServerErrorException.java:102) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:189) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:147) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.client.RestTemplate.handleResponse(RestTemplate.java:953) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.client.RestTemplate.doExecute(RestTemplate.java:902) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.client.RestTemplate.execute(RestTemplate.java:801) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.client.RestTemplate.postForObject(RestTemplate.java:518) ~[spring-web-6.2.12.jar:6.2.12]
	at hr.fer.ecommerce.gateway.client.MicroserviceClient.createPayment(MicroserviceClient.java:44) ~[classes/:na]
	at hr.fer.ecommerce.gateway.service.SagaService.createPayment(SagaService.java:131) ~[classes/:na]
	at hr.fer.ecommerce.gateway.service.SagaService.placeOrder(SagaService.java:38) ~[classes/:na]
	at hr.fer.ecommerce.gateway.controller.GatewayController.placeOrder(GatewayController.java:35) ~[classes/:na]
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:580) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:360) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.validation.beanvalidation.MethodValidationInterceptor.invoke(MethodValidationInterceptor.java:172) ~[spring-context-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:728) ~[spring-aop-6.2.12.jar:6.2.12]
	at hr.fer.ecommerce.gateway.controller.GatewayController$$SpringCGLIB$$0.placeOrder(<generated>) ~[classes/:na]
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:580) ~[na:na]
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:258) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:191) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:991) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:896) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590) ~[tomcat-embed-core-10.1.48.jar:6.0]
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658) ~[tomcat-embed-core-10.1.48.jar:6.0]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51) ~[tomcat-embed-websocket-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.12.jar:6.2.12]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.12.jar:6.2.12]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.12.jar:6.2.12]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.12.jar:6.2.12]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:165) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:88) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:113) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:83) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:72) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:342) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:399) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:903) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1774) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:973) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:491) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at java.base/java.lang.Thread.run(Thread.java:1583) ~[na:na]

2026-01-27T16:05:20.036+01:00 ERROR 7724 --- [Api Gateway] [http-nio-8080-exec-6] h.f.e.gateway.service.SagaService        : Error during order placement: Failed to create payment: 500  on POST request for "http://localhost:8084/api/payments": "{"status":500,"message":"An unexpected error occurred: Payment already exists for order: 11","timestamp":"2026-01-27T16:05:20.0203526","path":"/api/payments"}"

java.lang.RuntimeException: Failed to create payment: 500  on POST request for "http://localhost:8084/api/payments": "{"status":500,"message":"An unexpected error occurred: Payment already exists for order: 11","timestamp":"2026-01-27T16:05:20.0203526","path":"/api/payments"}"
	at hr.fer.ecommerce.gateway.client.MicroserviceClient.createPayment(MicroserviceClient.java:49) ~[classes/:na]
	at hr.fer.ecommerce.gateway.service.SagaService.createPayment(SagaService.java:131) ~[classes/:na]
	at hr.fer.ecommerce.gateway.service.SagaService.placeOrder(SagaService.java:38) ~[classes/:na]
	at hr.fer.ecommerce.gateway.controller.GatewayController.placeOrder(GatewayController.java:35) ~[classes/:na]
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:580) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:360) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.validation.beanvalidation.MethodValidationInterceptor.invoke(MethodValidationInterceptor.java:172) ~[spring-context-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:728) ~[spring-aop-6.2.12.jar:6.2.12]
	at hr.fer.ecommerce.gateway.controller.GatewayController$$SpringCGLIB$$0.placeOrder(<generated>) ~[classes/:na]
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:580) ~[na:na]
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:258) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:191) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:991) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:896) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590) ~[tomcat-embed-core-10.1.48.jar:6.0]
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658) ~[tomcat-embed-core-10.1.48.jar:6.0]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51) ~[tomcat-embed-websocket-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.12.jar:6.2.12]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.12.jar:6.2.12]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.12.jar:6.2.12]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.12.jar:6.2.12]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:165) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:88) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:113) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:83) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:72) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:342) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:399) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:903) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1774) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:973) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:491) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at java.base/java.lang.Thread.run(Thread.java:1583) ~[na:na]
Caused by: org.springframework.web.client.HttpServerErrorException$InternalServerError: 500  on POST request for "http://localhost:8084/api/payments": "{"status":500,"message":"An unexpected error occurred: Payment already exists for order: 11","timestamp":"2026-01-27T16:05:20.0203526","path":"/api/payments"}"
	at org.springframework.web.client.HttpServerErrorException.create(HttpServerErrorException.java:102) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:189) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:147) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.client.RestTemplate.handleResponse(RestTemplate.java:953) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.client.RestTemplate.doExecute(RestTemplate.java:902) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.client.RestTemplate.execute(RestTemplate.java:801) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.client.RestTemplate.postForObject(RestTemplate.java:518) ~[spring-web-6.2.12.jar:6.2.12]
	at hr.fer.ecommerce.gateway.client.MicroserviceClient.createPayment(MicroserviceClient.java:44) ~[classes/:na]
	... 64 common frames omitted

2026-01-27T16:05:20.045+01:00  WARN 7724 --- [Api Gateway] [http-nio-8080-exec-6] h.f.e.gateway.client.MicroserviceClient  : Compensating order: cancelling order ID 11
2026-01-27T16:05:20.086+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-6] h.f.e.g.controller.GatewayController     : GATEWAY | SAGA | totalDuration=250 ms | success=false
2026-01-27T16:05:52.790+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-7] h.f.e.g.controller.GatewayController     : Received place order request for customer: john.doe@example.com
2026-01-27T16:05:52.790+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-7] h.f.e.gateway.service.SagaService        : Starting order placement for customer: john.doe@example.com
2026-01-27T16:05:52.790+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-7] h.f.e.gateway.service.SagaService        : Step 1: Creating order...
2026-01-27T16:05:52.790+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-7] h.f.e.gateway.client.MicroserviceClient  : Creating order at: http://localhost:8082/api/orders
2026-01-27T16:05:52.847+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-7] h.f.e.gateway.client.MicroserviceClient  : Order created successfully with ID: 12
2026-01-27T16:05:52.849+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-7] h.f.e.gateway.service.SagaService        : Order created with ID: 12
2026-01-27T16:05:52.851+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-7] h.f.e.gateway.service.SagaService        : Step 2: Processing payment...
2026-01-27T16:05:52.852+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-7] h.f.e.gateway.client.MicroserviceClient  : Creating payment at: http://localhost:8084/api/payments
2026-01-27T16:05:52.858+01:00 ERROR 7724 --- [Api Gateway] [http-nio-8080-exec-7] h.f.e.gateway.client.MicroserviceClient  : Error creating payment: 500  on POST request for "http://localhost:8084/api/payments": "{"status":500,"message":"An unexpected error occurred: Payment already exists for order: 12","timestamp":"2026-01-27T16:05:52.8582126","path":"/api/payments"}"

org.springframework.web.client.HttpServerErrorException$InternalServerError: 500  on POST request for "http://localhost:8084/api/payments": "{"status":500,"message":"An unexpected error occurred: Payment already exists for order: 12","timestamp":"2026-01-27T16:05:52.8582126","path":"/api/payments"}"
	at org.springframework.web.client.HttpServerErrorException.create(HttpServerErrorException.java:102) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:189) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:147) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.client.RestTemplate.handleResponse(RestTemplate.java:953) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.client.RestTemplate.doExecute(RestTemplate.java:902) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.client.RestTemplate.execute(RestTemplate.java:801) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.client.RestTemplate.postForObject(RestTemplate.java:518) ~[spring-web-6.2.12.jar:6.2.12]
	at hr.fer.ecommerce.gateway.client.MicroserviceClient.createPayment(MicroserviceClient.java:44) ~[classes/:na]
	at hr.fer.ecommerce.gateway.service.SagaService.createPayment(SagaService.java:131) ~[classes/:na]
	at hr.fer.ecommerce.gateway.service.SagaService.placeOrder(SagaService.java:38) ~[classes/:na]
	at hr.fer.ecommerce.gateway.controller.GatewayController.placeOrder(GatewayController.java:35) ~[classes/:na]
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:580) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:360) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.validation.beanvalidation.MethodValidationInterceptor.invoke(MethodValidationInterceptor.java:172) ~[spring-context-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:728) ~[spring-aop-6.2.12.jar:6.2.12]
	at hr.fer.ecommerce.gateway.controller.GatewayController$$SpringCGLIB$$0.placeOrder(<generated>) ~[classes/:na]
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:580) ~[na:na]
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:258) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:191) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:991) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:896) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590) ~[tomcat-embed-core-10.1.48.jar:6.0]
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658) ~[tomcat-embed-core-10.1.48.jar:6.0]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51) ~[tomcat-embed-websocket-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.12.jar:6.2.12]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.12.jar:6.2.12]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.12.jar:6.2.12]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.12.jar:6.2.12]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:165) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:88) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:113) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:83) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:72) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:342) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:399) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:903) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1774) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:973) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:491) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at java.base/java.lang.Thread.run(Thread.java:1583) ~[na:na]

2026-01-27T16:05:52.865+01:00 ERROR 7724 --- [Api Gateway] [http-nio-8080-exec-7] h.f.e.gateway.service.SagaService        : Error during order placement: Failed to create payment: 500  on POST request for "http://localhost:8084/api/payments": "{"status":500,"message":"An unexpected error occurred: Payment already exists for order: 12","timestamp":"2026-01-27T16:05:52.8582126","path":"/api/payments"}"

java.lang.RuntimeException: Failed to create payment: 500  on POST request for "http://localhost:8084/api/payments": "{"status":500,"message":"An unexpected error occurred: Payment already exists for order: 12","timestamp":"2026-01-27T16:05:52.8582126","path":"/api/payments"}"
	at hr.fer.ecommerce.gateway.client.MicroserviceClient.createPayment(MicroserviceClient.java:49) ~[classes/:na]
	at hr.fer.ecommerce.gateway.service.SagaService.createPayment(SagaService.java:131) ~[classes/:na]
	at hr.fer.ecommerce.gateway.service.SagaService.placeOrder(SagaService.java:38) ~[classes/:na]
	at hr.fer.ecommerce.gateway.controller.GatewayController.placeOrder(GatewayController.java:35) ~[classes/:na]
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:580) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:360) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.validation.beanvalidation.MethodValidationInterceptor.invoke(MethodValidationInterceptor.java:172) ~[spring-context-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:728) ~[spring-aop-6.2.12.jar:6.2.12]
	at hr.fer.ecommerce.gateway.controller.GatewayController$$SpringCGLIB$$0.placeOrder(<generated>) ~[classes/:na]
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:580) ~[na:na]
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:258) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:191) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:991) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:896) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590) ~[tomcat-embed-core-10.1.48.jar:6.0]
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658) ~[tomcat-embed-core-10.1.48.jar:6.0]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51) ~[tomcat-embed-websocket-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.12.jar:6.2.12]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.12.jar:6.2.12]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.12.jar:6.2.12]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.12.jar:6.2.12]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:165) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:88) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:113) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:83) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:72) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:342) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:399) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:903) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1774) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:973) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:491) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at java.base/java.lang.Thread.run(Thread.java:1583) ~[na:na]
Caused by: org.springframework.web.client.HttpServerErrorException$InternalServerError: 500  on POST request for "http://localhost:8084/api/payments": "{"status":500,"message":"An unexpected error occurred: Payment already exists for order: 12","timestamp":"2026-01-27T16:05:52.8582126","path":"/api/payments"}"
	at org.springframework.web.client.HttpServerErrorException.create(HttpServerErrorException.java:102) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:189) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:147) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.client.RestTemplate.handleResponse(RestTemplate.java:953) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.client.RestTemplate.doExecute(RestTemplate.java:902) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.client.RestTemplate.execute(RestTemplate.java:801) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.client.RestTemplate.postForObject(RestTemplate.java:518) ~[spring-web-6.2.12.jar:6.2.12]
	at hr.fer.ecommerce.gateway.client.MicroserviceClient.createPayment(MicroserviceClient.java:44) ~[classes/:na]
	... 64 common frames omitted

2026-01-27T16:05:52.865+01:00  WARN 7724 --- [Api Gateway] [http-nio-8080-exec-7] h.f.e.gateway.client.MicroserviceClient  : Compensating order: cancelling order ID 12
2026-01-27T16:05:52.898+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-7] h.f.e.g.controller.GatewayController     : GATEWAY | SAGA | totalDuration=108 ms | success=false
2026-01-27T16:05:53.908+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-8] h.f.e.g.controller.GatewayController     : Received 2PC place order request for customer: john.doe@example.com
2026-01-27T16:05:53.908+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-8] h.f.e.g.service.TwoPhaseCommitService    : Starting 2PC for customer: john.doe@example.com
2026-01-27T16:05:53.908+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-8] h.f.e.g.service.TwoPhaseCommitService    : PHASE 1: PREPARE
2026-01-27T16:05:53.908+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-8] h.f.e.g.service.TwoPhaseCommitService    : Preparing order and reserving stock
2026-01-27T16:05:53.913+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-8] h.f.e.gateway.client.MicroserviceClient  : 2PC: Preparing order at: http://localhost:8082/api/orders/prepare
2026-01-27T16:05:53.973+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-8] h.f.e.gateway.client.MicroserviceClient  : 2PC: Order prepared with ID: 13
2026-01-27T16:05:53.981+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-8] h.f.e.g.service.TwoPhaseCommitService    : Order prepared: ID=13, status=PREPARED
2026-01-27T16:05:53.982+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-8] h.f.e.g.service.TwoPhaseCommitService    : Pre-authorizing payment
2026-01-27T16:05:53.982+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-8] h.f.e.gateway.client.MicroserviceClient  : 2PC: Preparing payment at: http://localhost:8084/api/payments/prepare
2026-01-27T16:05:54.028+01:00 ERROR 7724 --- [Api Gateway] [http-nio-8080-exec-8] h.f.e.gateway.client.MicroserviceClient  : 2PC: Failed to prepare payment: 500  on POST request for "http://localhost:8084/api/payments/prepare": "{"status":500,"message":"An unexpected error occurred: could not execute statement [Unique index or primary key violation: \"PUBLIC.CONSTRAINT_INDEX_8 ON PUBLIC.PAYMENTS(ORDER_ID NULLS FIRST) VALUES ( /* 36 */ CAST(13 AS BIGINT) )\"; SQL statement:\ninsert into payments (card_last_four_digits,created_at,failure_reason,order_id,paid_amount,paid_customer_email,paid_customer_name,payment_method,payment_provider,processed_at,status,transaction_id,updated_at,version,id) values (?,?,?,?,?,?,?,?,?,?,?,?,?,?,default) [23505-232]] [insert into payments (card_last_four_digits,created_at,failure_reason,order_id,paid_amount,paid_customer_email,paid_customer_name,payment_method,payment_provider,processed_at,status,transaction_id,updated_at,version,id) values (?,?,?,?,?,?,?,?,?,?,?,?,?,?,default)]; SQL [insert into payments (card_last_four_digits,created_at,failure_reason,order_id,paid_amount,paid_customer_email,paid_customer_name,payment_method,payment_provider,processed_at,status,transaction_id,updated_at,version,id) values (?,?,?,?,?,?,?,?,?,?,?,?,?,?,default)]; constraint [PUBLIC.CONSTRAINT_INDEX_8]","timestamp":"2026-01-27T16:05:54.0264202","path":"/api/payments/prepare"}"

org.springframework.web.client.HttpServerErrorException$InternalServerError: 500  on POST request for "http://localhost:8084/api/payments/prepare": "{"status":500,"message":"An unexpected error occurred: could not execute statement [Unique index or primary key violation: \"PUBLIC.CONSTRAINT_INDEX_8 ON PUBLIC.PAYMENTS(ORDER_ID NULLS FIRST) VALUES ( /* 36 */ CAST(13 AS BIGINT) )\"; SQL statement:\ninsert into payments (card_last_four_digits,created_at,failure_reason,order_id,paid_amount,paid_customer_email,paid_customer_name,payment_method,payment_provider,processed_at,status,transaction_id,updated_at,version,id) values (?,?,?,?,?,?,?,?,?,?,?,?,?,?,default) [23505-232]] [insert into payments (card_last_four_digits,created_at,failure_reason,order_id,paid_amount,paid_customer_email,paid_customer_name,payment_method,payment_provider,processed_at,status,transaction_id,updated_at,version,id) values (?,?,?,?,?,?,?,?,?,?,?,?,?,?,default)]; SQL [insert into payments (card_last_four_digits,created_at,failure_reason,order_id,paid_amount,paid_customer_email,paid_customer_name,payment_method,payment_provider,processed_at,status,transaction_id,updated_at,version,id) values (?,?,?,?,?,?,?,?,?,?,?,?,?,?,default)]; constraint [PUBLIC.CONSTRAINT_INDEX_8]","timestamp":"2026-01-27T16:05:54.0264202","path":"/api/payments/prepare"}"
	at org.springframework.web.client.HttpServerErrorException.create(HttpServerErrorException.java:102) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:189) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:147) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.client.RestTemplate.handleResponse(RestTemplate.java:953) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.client.RestTemplate.doExecute(RestTemplate.java:902) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.client.RestTemplate.execute(RestTemplate.java:801) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.client.RestTemplate.postForObject(RestTemplate.java:518) ~[spring-web-6.2.12.jar:6.2.12]
	at hr.fer.ecommerce.gateway.client.MicroserviceClient.preparePayment(MicroserviceClient.java:150) ~[classes/:na]
	at hr.fer.ecommerce.gateway.service.TwoPhaseCommitService.preparePhase(TwoPhaseCommitService.java:79) ~[classes/:na]
	at hr.fer.ecommerce.gateway.service.TwoPhaseCommitService.placeOrderWith2PC(TwoPhaseCommitService.java:33) ~[classes/:na]
	at hr.fer.ecommerce.gateway.controller.GatewayController.placeOrderWith2PC(GatewayController.java:57) ~[classes/:na]
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:580) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:360) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.validation.beanvalidation.MethodValidationInterceptor.invoke(MethodValidationInterceptor.java:172) ~[spring-context-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:728) ~[spring-aop-6.2.12.jar:6.2.12]
	at hr.fer.ecommerce.gateway.controller.GatewayController$$SpringCGLIB$$0.placeOrderWith2PC(<generated>) ~[classes/:na]
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:580) ~[na:na]
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:258) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:191) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:991) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:896) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590) ~[tomcat-embed-core-10.1.48.jar:6.0]
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658) ~[tomcat-embed-core-10.1.48.jar:6.0]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51) ~[tomcat-embed-websocket-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.12.jar:6.2.12]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.12.jar:6.2.12]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.12.jar:6.2.12]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.12.jar:6.2.12]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:165) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:88) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:113) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:83) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:72) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:342) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:399) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:903) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1774) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:973) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:491) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at java.base/java.lang.Thread.run(Thread.java:1583) ~[na:na]

2026-01-27T16:05:54.033+01:00 ERROR 7724 --- [Api Gateway] [http-nio-8080-exec-8] h.f.e.g.service.TwoPhaseCommitService    : Prepare phase failed: Failed to prepare payment: 500  on POST request for "http://localhost:8084/api/payments/prepare": "{"status":500,"message":"An unexpected error occurred: could not execute statement [Unique index or primary key violation: \"PUBLIC.CONSTRAINT_INDEX_8 ON PUBLIC.PAYMENTS(ORDER_ID NULLS FIRST) VALUES ( /* 36 */ CAST(13 AS BIGINT) )\"; SQL statement:\ninsert into payments (card_last_four_digits,created_at,failure_reason,order_id,paid_amount,paid_customer_email,paid_customer_name,payment_method,payment_provider,processed_at,status,transaction_id,updated_at,version,id) values (?,?,?,?,?,?,?,?,?,?,?,?,?,?,default) [23505-232]] [insert into payments (card_last_four_digits,created_at,failure_reason,order_id,paid_amount,paid_customer_email,paid_customer_name,payment_method,payment_provider,processed_at,status,transaction_id,updated_at,version,id) values (?,?,?,?,?,?,?,?,?,?,?,?,?,?,default)]; SQL [insert into payments (card_last_four_digits,created_at,failure_reason,order_id,paid_amount,paid_customer_email,paid_customer_name,payment_method,payment_provider,processed_at,status,transaction_id,updated_at,version,id) values (?,?,?,?,?,?,?,?,?,?,?,?,?,?,default)]; constraint [PUBLIC.CONSTRAINT_INDEX_8]","timestamp":"2026-01-27T16:05:54.0264202","path":"/api/payments/prepare"}"
2026-01-27T16:05:54.036+01:00  WARN 7724 --- [Api Gateway] [http-nio-8080-exec-8] h.f.e.g.service.TwoPhaseCommitService    : Aborting transaction - releasing all prepared resources
2026-01-27T16:05:54.037+01:00  WARN 7724 --- [Api Gateway] [http-nio-8080-exec-8] h.f.e.g.service.TwoPhaseCommitService    : Aborting order: ID=13
2026-01-27T16:05:54.037+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-8] h.f.e.gateway.client.MicroserviceClient  : 2PC: Aborting order at: http://localhost:8082/api/orders/13/abort
2026-01-27T16:05:54.074+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-8] h.f.e.gateway.client.MicroserviceClient  : 2PC: Order aborted - ID: 13
2026-01-27T16:05:54.074+01:00  WARN 7724 --- [Api Gateway] [http-nio-8080-exec-8] h.f.e.g.service.TwoPhaseCommitService    : Order aborted
2026-01-27T16:05:54.074+01:00  WARN 7724 --- [Api Gateway] [http-nio-8080-exec-8] h.f.e.g.service.TwoPhaseCommitService    : Abort phase completed
2026-01-27T16:05:54.074+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-8] h.f.e.g.controller.GatewayController     : GATEWAY | 2PC | totalDuration=164 ms | success=false
2026-01-27T16:05:57.339+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-9] h.f.e.g.controller.ConfigController      : Gateway: Getting all configuration status
2026-01-27T16:05:57.339+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-9] h.f.e.gateway.client.MicroserviceClient  : Getting FINA status
2026-01-27T16:05:57.354+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-9] h.f.e.gateway.client.MicroserviceClient  : Getting carrier status
2026-01-27T16:05:57.390+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-10] h.f.e.g.controller.ConfigController      : Gateway: Getting all configuration status
2026-01-27T16:05:57.390+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-10] h.f.e.gateway.client.MicroserviceClient  : Getting FINA status
2026-01-27T16:05:57.399+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-10] h.f.e.gateway.client.MicroserviceClient  : Getting carrier status
2026-01-27T16:06:05.336+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-2] h.f.e.g.controller.GatewayController     : Received place order request for customer: john.doe@example.com
2026-01-27T16:06:05.336+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-2] h.f.e.gateway.service.SagaService        : Starting order placement for customer: john.doe@example.com
2026-01-27T16:06:05.336+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-2] h.f.e.gateway.service.SagaService        : Step 1: Creating order...
2026-01-27T16:06:05.341+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-2] h.f.e.gateway.client.MicroserviceClient  : Creating order at: http://localhost:8082/api/orders
2026-01-27T16:06:05.400+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-2] h.f.e.gateway.client.MicroserviceClient  : Order created successfully with ID: 14
2026-01-27T16:06:05.400+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-2] h.f.e.gateway.service.SagaService        : Order created with ID: 14
2026-01-27T16:06:05.400+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-2] h.f.e.gateway.service.SagaService        : Step 2: Processing payment...
2026-01-27T16:06:05.400+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-2] h.f.e.gateway.client.MicroserviceClient  : Creating payment at: http://localhost:8084/api/payments
2026-01-27T16:06:05.425+01:00 ERROR 7724 --- [Api Gateway] [http-nio-8080-exec-2] h.f.e.gateway.client.MicroserviceClient  : Error creating payment: 500  on POST request for "http://localhost:8084/api/payments": "{"status":500,"message":"An unexpected error occurred: Payment already exists for order: 14","timestamp":"2026-01-27T16:06:05.417118","path":"/api/payments"}"

org.springframework.web.client.HttpServerErrorException$InternalServerError: 500  on POST request for "http://localhost:8084/api/payments": "{"status":500,"message":"An unexpected error occurred: Payment already exists for order: 14","timestamp":"2026-01-27T16:06:05.417118","path":"/api/payments"}"
	at org.springframework.web.client.HttpServerErrorException.create(HttpServerErrorException.java:102) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:189) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:147) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.client.RestTemplate.handleResponse(RestTemplate.java:953) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.client.RestTemplate.doExecute(RestTemplate.java:902) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.client.RestTemplate.execute(RestTemplate.java:801) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.client.RestTemplate.postForObject(RestTemplate.java:518) ~[spring-web-6.2.12.jar:6.2.12]
	at hr.fer.ecommerce.gateway.client.MicroserviceClient.createPayment(MicroserviceClient.java:44) ~[classes/:na]
	at hr.fer.ecommerce.gateway.service.SagaService.createPayment(SagaService.java:131) ~[classes/:na]
	at hr.fer.ecommerce.gateway.service.SagaService.placeOrder(SagaService.java:38) ~[classes/:na]
	at hr.fer.ecommerce.gateway.controller.GatewayController.placeOrder(GatewayController.java:35) ~[classes/:na]
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:580) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:360) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.validation.beanvalidation.MethodValidationInterceptor.invoke(MethodValidationInterceptor.java:172) ~[spring-context-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:728) ~[spring-aop-6.2.12.jar:6.2.12]
	at hr.fer.ecommerce.gateway.controller.GatewayController$$SpringCGLIB$$0.placeOrder(<generated>) ~[classes/:na]
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:580) ~[na:na]
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:258) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:191) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:991) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:896) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590) ~[tomcat-embed-core-10.1.48.jar:6.0]
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658) ~[tomcat-embed-core-10.1.48.jar:6.0]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51) ~[tomcat-embed-websocket-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.12.jar:6.2.12]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.12.jar:6.2.12]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.12.jar:6.2.12]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.12.jar:6.2.12]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:165) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:88) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:113) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:83) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:72) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:342) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:399) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:903) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1774) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:973) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:491) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at java.base/java.lang.Thread.run(Thread.java:1583) ~[na:na]

2026-01-27T16:06:05.426+01:00 ERROR 7724 --- [Api Gateway] [http-nio-8080-exec-2] h.f.e.gateway.service.SagaService        : Error during order placement: Failed to create payment: 500  on POST request for "http://localhost:8084/api/payments": "{"status":500,"message":"An unexpected error occurred: Payment already exists for order: 14","timestamp":"2026-01-27T16:06:05.417118","path":"/api/payments"}"

java.lang.RuntimeException: Failed to create payment: 500  on POST request for "http://localhost:8084/api/payments": "{"status":500,"message":"An unexpected error occurred: Payment already exists for order: 14","timestamp":"2026-01-27T16:06:05.417118","path":"/api/payments"}"
	at hr.fer.ecommerce.gateway.client.MicroserviceClient.createPayment(MicroserviceClient.java:49) ~[classes/:na]
	at hr.fer.ecommerce.gateway.service.SagaService.createPayment(SagaService.java:131) ~[classes/:na]
	at hr.fer.ecommerce.gateway.service.SagaService.placeOrder(SagaService.java:38) ~[classes/:na]
	at hr.fer.ecommerce.gateway.controller.GatewayController.placeOrder(GatewayController.java:35) ~[classes/:na]
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:580) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:360) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.validation.beanvalidation.MethodValidationInterceptor.invoke(MethodValidationInterceptor.java:172) ~[spring-context-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:728) ~[spring-aop-6.2.12.jar:6.2.12]
	at hr.fer.ecommerce.gateway.controller.GatewayController$$SpringCGLIB$$0.placeOrder(<generated>) ~[classes/:na]
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:580) ~[na:na]
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:258) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:191) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:991) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:896) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590) ~[tomcat-embed-core-10.1.48.jar:6.0]
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658) ~[tomcat-embed-core-10.1.48.jar:6.0]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51) ~[tomcat-embed-websocket-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.12.jar:6.2.12]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.12.jar:6.2.12]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.12.jar:6.2.12]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.12.jar:6.2.12]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:165) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:88) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:113) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:83) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:72) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:342) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:399) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:903) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1774) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:973) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:491) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at java.base/java.lang.Thread.run(Thread.java:1583) ~[na:na]
Caused by: org.springframework.web.client.HttpServerErrorException$InternalServerError: 500  on POST request for "http://localhost:8084/api/payments": "{"status":500,"message":"An unexpected error occurred: Payment already exists for order: 14","timestamp":"2026-01-27T16:06:05.417118","path":"/api/payments"}"
	at org.springframework.web.client.HttpServerErrorException.create(HttpServerErrorException.java:102) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:189) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:147) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.client.RestTemplate.handleResponse(RestTemplate.java:953) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.client.RestTemplate.doExecute(RestTemplate.java:902) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.client.RestTemplate.execute(RestTemplate.java:801) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.client.RestTemplate.postForObject(RestTemplate.java:518) ~[spring-web-6.2.12.jar:6.2.12]
	at hr.fer.ecommerce.gateway.client.MicroserviceClient.createPayment(MicroserviceClient.java:44) ~[classes/:na]
	... 64 common frames omitted

2026-01-27T16:06:05.426+01:00  WARN 7724 --- [Api Gateway] [http-nio-8080-exec-2] h.f.e.gateway.client.MicroserviceClient  : Compensating order: cancelling order ID 14
2026-01-27T16:06:05.459+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-2] h.f.e.g.controller.GatewayController     : GATEWAY | SAGA | totalDuration=120 ms | success=false
2026-01-27T16:06:06.525+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-3] h.f.e.g.controller.GatewayController     : Received 2PC place order request for customer: john.doe@example.com
2026-01-27T16:06:06.525+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-3] h.f.e.g.service.TwoPhaseCommitService    : Starting 2PC for customer: john.doe@example.com
2026-01-27T16:06:06.525+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-3] h.f.e.g.service.TwoPhaseCommitService    : PHASE 1: PREPARE
2026-01-27T16:06:06.525+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-3] h.f.e.g.service.TwoPhaseCommitService    : Preparing order and reserving stock
2026-01-27T16:06:06.525+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-3] h.f.e.gateway.client.MicroserviceClient  : 2PC: Preparing order at: http://localhost:8082/api/orders/prepare
2026-01-27T16:06:06.576+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-3] h.f.e.gateway.client.MicroserviceClient  : 2PC: Order prepared with ID: 15
2026-01-27T16:06:06.576+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-3] h.f.e.g.service.TwoPhaseCommitService    : Order prepared: ID=15, status=PREPARED
2026-01-27T16:06:06.576+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-3] h.f.e.g.service.TwoPhaseCommitService    : Pre-authorizing payment
2026-01-27T16:06:06.576+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-3] h.f.e.gateway.client.MicroserviceClient  : 2PC: Preparing payment at: http://localhost:8084/api/payments/prepare
2026-01-27T16:06:06.609+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-3] h.f.e.gateway.client.MicroserviceClient  : 2PC: Payment prepared with ID: 44
2026-01-27T16:06:06.609+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-3] h.f.e.g.service.TwoPhaseCommitService    : Payment prepared: ID=44, status=PRE_AUTHORIZED
2026-01-27T16:06:06.609+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-3] h.f.e.g.service.TwoPhaseCommitService    : Reserving shipment capacity
2026-01-27T16:06:06.609+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-3] h.f.e.gateway.client.MicroserviceClient  : 2PC: Preparing shipment at: http://localhost:8083/api/shipments/prepare
2026-01-27T16:06:06.651+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-3] h.f.e.gateway.client.MicroserviceClient  : 2PC: Shipment prepared with ID: 40
2026-01-27T16:06:06.651+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-3] h.f.e.g.service.TwoPhaseCommitService    : Shipment prepared: ID=40, status=RESERVED
2026-01-27T16:06:06.651+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-3] h.f.e.g.service.TwoPhaseCommitService    : Prepare phase completed - all resources reserved
2026-01-27T16:06:06.651+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-3] h.f.e.g.service.TwoPhaseCommitService    : All participants voted READY
2026-01-27T16:06:06.651+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-3] h.f.e.g.service.TwoPhaseCommitService    : PHASE 2: COMMIT
2026-01-27T16:06:06.651+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-3] h.f.e.g.service.TwoPhaseCommitService    : Committing order
2026-01-27T16:06:06.651+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-3] h.f.e.gateway.client.MicroserviceClient  : 2PC: Committing order at: http://localhost:8082/api/orders/15/commit
2026-01-27T16:06:06.669+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-3] h.f.e.gateway.client.MicroserviceClient  : 2PC: Order committed - ID: 15
2026-01-27T16:06:06.669+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-3] h.f.e.g.service.TwoPhaseCommitService    : Order committed: ID=15
2026-01-27T16:06:06.669+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-3] h.f.e.g.service.TwoPhaseCommitService    : Committing payment
2026-01-27T16:06:06.669+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-3] h.f.e.gateway.client.MicroserviceClient  : 2PC: Committing payment at: http://localhost:8084/api/payments/44/commit
2026-01-27T16:06:06.684+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-3] h.f.e.gateway.client.MicroserviceClient  : 2PC: Payment committed - ID: 44
2026-01-27T16:06:06.684+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-3] h.f.e.g.service.TwoPhaseCommitService    : Payment committed: ID=44
2026-01-27T16:06:06.684+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-3] h.f.e.g.service.TwoPhaseCommitService    : Committing shipment
2026-01-27T16:06:06.684+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-3] h.f.e.gateway.client.MicroserviceClient  : 2PC: Committing shipment at: http://localhost:8083/api/shipments/40/commit
2026-01-27T16:06:06.705+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-3] h.f.e.gateway.client.MicroserviceClient  : 2PC: Shipment committed - ID: 40
2026-01-27T16:06:06.705+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-3] h.f.e.g.service.TwoPhaseCommitService    : Shipment committed: ID=40
2026-01-27T16:06:06.705+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-3] h.f.e.g.service.TwoPhaseCommitService    : Commit phase completed
2026-01-27T16:06:06.705+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-3] h.f.e.g.service.TwoPhaseCommitService    : 2PC completed successfully - Order ID: 15
2026-01-27T16:06:06.705+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-3] h.f.e.g.controller.GatewayController     : GATEWAY | 2PC | totalDuration=181 ms | success=true
2026-01-27T16:06:09.051+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-4] h.f.e.g.controller.GatewayController     : Received 2PC place order request for customer: john.doe@example.com
2026-01-27T16:06:09.051+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-4] h.f.e.g.service.TwoPhaseCommitService    : Starting 2PC for customer: john.doe@example.com
2026-01-27T16:06:09.051+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-4] h.f.e.g.service.TwoPhaseCommitService    : PHASE 1: PREPARE
2026-01-27T16:06:09.051+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-4] h.f.e.g.service.TwoPhaseCommitService    : Preparing order and reserving stock
2026-01-27T16:06:09.058+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-4] h.f.e.gateway.client.MicroserviceClient  : 2PC: Preparing order at: http://localhost:8082/api/orders/prepare
2026-01-27T16:06:09.116+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-4] h.f.e.gateway.client.MicroserviceClient  : 2PC: Order prepared with ID: 16
2026-01-27T16:06:09.116+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-4] h.f.e.g.service.TwoPhaseCommitService    : Order prepared: ID=16, status=PREPARED
2026-01-27T16:06:09.116+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-4] h.f.e.g.service.TwoPhaseCommitService    : Pre-authorizing payment
2026-01-27T16:06:09.116+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-4] h.f.e.gateway.client.MicroserviceClient  : 2PC: Preparing payment at: http://localhost:8084/api/payments/prepare
2026-01-27T16:06:09.149+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-4] h.f.e.gateway.client.MicroserviceClient  : 2PC: Payment prepared with ID: 45
2026-01-27T16:06:09.149+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-4] h.f.e.g.service.TwoPhaseCommitService    : Payment prepared: ID=45, status=PRE_AUTHORIZED
2026-01-27T16:06:09.149+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-4] h.f.e.g.service.TwoPhaseCommitService    : Reserving shipment capacity
2026-01-27T16:06:09.149+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-4] h.f.e.gateway.client.MicroserviceClient  : 2PC: Preparing shipment at: http://localhost:8083/api/shipments/prepare
2026-01-27T16:06:09.191+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-4] h.f.e.gateway.client.MicroserviceClient  : 2PC: Shipment prepared with ID: 41
2026-01-27T16:06:09.191+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-4] h.f.e.g.service.TwoPhaseCommitService    : Shipment prepared: ID=41, status=RESERVED
2026-01-27T16:06:09.191+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-4] h.f.e.g.service.TwoPhaseCommitService    : Prepare phase completed - all resources reserved
2026-01-27T16:06:09.199+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-4] h.f.e.g.service.TwoPhaseCommitService    : All participants voted READY
2026-01-27T16:06:09.199+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-4] h.f.e.g.service.TwoPhaseCommitService    : PHASE 2: COMMIT
2026-01-27T16:06:09.199+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-4] h.f.e.g.service.TwoPhaseCommitService    : Committing order
2026-01-27T16:06:09.199+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-4] h.f.e.gateway.client.MicroserviceClient  : 2PC: Committing order at: http://localhost:8082/api/orders/16/commit
2026-01-27T16:06:09.215+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-4] h.f.e.gateway.client.MicroserviceClient  : 2PC: Order committed - ID: 16
2026-01-27T16:06:09.215+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-4] h.f.e.g.service.TwoPhaseCommitService    : Order committed: ID=16
2026-01-27T16:06:09.215+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-4] h.f.e.g.service.TwoPhaseCommitService    : Committing payment
2026-01-27T16:06:09.215+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-4] h.f.e.gateway.client.MicroserviceClient  : 2PC: Committing payment at: http://localhost:8084/api/payments/45/commit
2026-01-27T16:06:09.237+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-4] h.f.e.gateway.client.MicroserviceClient  : 2PC: Payment committed - ID: 45
2026-01-27T16:06:09.238+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-4] h.f.e.g.service.TwoPhaseCommitService    : Payment committed: ID=45
2026-01-27T16:06:09.238+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-4] h.f.e.g.service.TwoPhaseCommitService    : Committing shipment
2026-01-27T16:06:09.239+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-4] h.f.e.gateway.client.MicroserviceClient  : 2PC: Committing shipment at: http://localhost:8083/api/shipments/41/commit
2026-01-27T16:06:09.265+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-4] h.f.e.gateway.client.MicroserviceClient  : 2PC: Shipment committed - ID: 41
2026-01-27T16:06:09.268+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-4] h.f.e.g.service.TwoPhaseCommitService    : Shipment committed: ID=41
2026-01-27T16:06:09.268+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-4] h.f.e.g.service.TwoPhaseCommitService    : Commit phase completed
2026-01-27T16:06:09.268+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-4] h.f.e.g.service.TwoPhaseCommitService    : 2PC completed successfully - Order ID: 16
2026-01-27T16:06:09.268+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-4] h.f.e.g.controller.GatewayController     : GATEWAY | 2PC | totalDuration=215 ms | success=true
2026-01-27T16:06:10.231+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-5] h.f.e.g.controller.GatewayController     : Received place order request for customer: john.doe@example.com
2026-01-27T16:06:10.231+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-5] h.f.e.gateway.service.SagaService        : Starting order placement for customer: john.doe@example.com
2026-01-27T16:06:10.231+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-5] h.f.e.gateway.service.SagaService        : Step 1: Creating order...
2026-01-27T16:06:10.231+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-5] h.f.e.gateway.client.MicroserviceClient  : Creating order at: http://localhost:8082/api/orders
2026-01-27T16:06:10.295+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-5] h.f.e.gateway.client.MicroserviceClient  : Order created successfully with ID: 17
2026-01-27T16:06:10.296+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-5] h.f.e.gateway.service.SagaService        : Order created with ID: 17
2026-01-27T16:06:10.299+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-5] h.f.e.gateway.service.SagaService        : Step 2: Processing payment...
2026-01-27T16:06:10.299+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-5] h.f.e.gateway.client.MicroserviceClient  : Creating payment at: http://localhost:8084/api/payments
2026-01-27T16:06:10.338+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-5] h.f.e.gateway.client.MicroserviceClient  : Payment created successfully with ID: 46
2026-01-27T16:06:10.338+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-5] h.f.e.gateway.service.SagaService        : Payment created with ID: 46 and transaction ID: TXN-68228841-45c2-46b3-89d1-95c7f25dc3c9
2026-01-27T16:06:10.338+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-5] h.f.e.gateway.service.SagaService        : Step 3: Creating shipment...
2026-01-27T16:06:10.338+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-5] h.f.e.gateway.client.MicroserviceClient  : Creating shipment at: http://localhost:8083/api/shipments
2026-01-27T16:06:10.371+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-5] h.f.e.gateway.client.MicroserviceClient  : Shipment created successfully with ID: 42
2026-01-27T16:06:10.371+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-5] h.f.e.gateway.service.SagaService        : Shipment created with ID: 42
2026-01-27T16:06:10.371+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-5] h.f.e.gateway.service.SagaService        : Order placement completed successfully for order ID: 17
2026-01-27T16:06:10.371+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-5] h.f.e.g.controller.GatewayController     : GATEWAY | SAGA | totalDuration=144 ms | success=true
2026-01-27T16:06:11.412+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-6] h.f.e.g.controller.GatewayController     : Received place order request for customer: john.doe@example.com
2026-01-27T16:06:11.412+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-6] h.f.e.gateway.service.SagaService        : Starting order placement for customer: john.doe@example.com
2026-01-27T16:06:11.412+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-6] h.f.e.gateway.service.SagaService        : Step 1: Creating order...
2026-01-27T16:06:11.412+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-6] h.f.e.gateway.client.MicroserviceClient  : Creating order at: http://localhost:8082/api/orders
2026-01-27T16:06:11.483+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-6] h.f.e.gateway.client.MicroserviceClient  : Order created successfully with ID: 18
2026-01-27T16:06:11.483+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-6] h.f.e.gateway.service.SagaService        : Order created with ID: 18
2026-01-27T16:06:11.484+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-6] h.f.e.gateway.service.SagaService        : Step 2: Processing payment...
2026-01-27T16:06:11.484+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-6] h.f.e.gateway.client.MicroserviceClient  : Creating payment at: http://localhost:8084/api/payments
2026-01-27T16:06:11.520+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-6] h.f.e.gateway.client.MicroserviceClient  : Payment created successfully with ID: 47
2026-01-27T16:06:11.520+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-6] h.f.e.gateway.service.SagaService        : Payment created with ID: 47 and transaction ID: TXN-bed202de-2cfd-4d03-b00b-c105193167a7
2026-01-27T16:06:11.528+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-6] h.f.e.gateway.service.SagaService        : Step 3: Creating shipment...
2026-01-27T16:06:11.528+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-6] h.f.e.gateway.client.MicroserviceClient  : Creating shipment at: http://localhost:8083/api/shipments
2026-01-27T16:06:11.554+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-6] h.f.e.gateway.client.MicroserviceClient  : Shipment created successfully with ID: 43
2026-01-27T16:06:11.554+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-6] h.f.e.gateway.service.SagaService        : Shipment created with ID: 43
2026-01-27T16:06:11.554+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-6] h.f.e.gateway.service.SagaService        : Order placement completed successfully for order ID: 18
2026-01-27T16:06:11.562+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-6] h.f.e.g.controller.GatewayController     : GATEWAY | SAGA | totalDuration=147 ms | success=true
2026-01-27T16:06:13.895+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-8] h.f.e.g.controller.GatewayController     : Received place order request for customer: john.doe@example.com
2026-01-27T16:06:13.895+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-8] h.f.e.gateway.service.SagaService        : Starting order placement for customer: john.doe@example.com
2026-01-27T16:06:13.901+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-8] h.f.e.gateway.service.SagaService        : Step 1: Creating order...
2026-01-27T16:06:13.901+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-8] h.f.e.gateway.client.MicroserviceClient  : Creating order at: http://localhost:8082/api/orders
2026-01-27T16:06:13.975+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-8] h.f.e.gateway.client.MicroserviceClient  : Order created successfully with ID: 19
2026-01-27T16:06:13.976+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-8] h.f.e.gateway.service.SagaService        : Order created with ID: 19
2026-01-27T16:06:13.976+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-8] h.f.e.gateway.service.SagaService        : Step 2: Processing payment...
2026-01-27T16:06:13.976+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-8] h.f.e.gateway.client.MicroserviceClient  : Creating payment at: http://localhost:8084/api/payments
2026-01-27T16:06:14.009+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-8] h.f.e.gateway.client.MicroserviceClient  : Payment created successfully with ID: 48
2026-01-27T16:06:14.009+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-8] h.f.e.gateway.service.SagaService        : Payment created with ID: 48 and transaction ID: TXN-e3ea90a1-f36f-411e-88f4-d3c0f374b11b
2026-01-27T16:06:14.009+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-8] h.f.e.gateway.service.SagaService        : Step 3: Creating shipment...
2026-01-27T16:06:14.009+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-8] h.f.e.gateway.client.MicroserviceClient  : Creating shipment at: http://localhost:8083/api/shipments
2026-01-27T16:06:14.043+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-8] h.f.e.gateway.client.MicroserviceClient  : Shipment created successfully with ID: 44
2026-01-27T16:06:14.043+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-8] h.f.e.gateway.service.SagaService        : Shipment created with ID: 44
2026-01-27T16:06:14.043+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-8] h.f.e.gateway.service.SagaService        : Order placement completed successfully for order ID: 19
2026-01-27T16:06:14.043+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-8] h.f.e.g.controller.GatewayController     : GATEWAY | SAGA | totalDuration=146 ms | success=true
2026-01-27T16:06:15.025+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-9] h.f.e.g.controller.GatewayController     : Received 2PC place order request for customer: john.doe@example.com
2026-01-27T16:06:15.025+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-9] h.f.e.g.service.TwoPhaseCommitService    : Starting 2PC for customer: john.doe@example.com
2026-01-27T16:06:15.025+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-9] h.f.e.g.service.TwoPhaseCommitService    : PHASE 1: PREPARE
2026-01-27T16:06:15.033+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-9] h.f.e.g.service.TwoPhaseCommitService    : Preparing order and reserving stock
2026-01-27T16:06:15.034+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-9] h.f.e.gateway.client.MicroserviceClient  : 2PC: Preparing order at: http://localhost:8082/api/orders/prepare
2026-01-27T16:06:15.084+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-9] h.f.e.gateway.client.MicroserviceClient  : 2PC: Order prepared with ID: 20
2026-01-27T16:06:15.091+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-9] h.f.e.g.service.TwoPhaseCommitService    : Order prepared: ID=20, status=PREPARED
2026-01-27T16:06:15.092+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-9] h.f.e.g.service.TwoPhaseCommitService    : Pre-authorizing payment
2026-01-27T16:06:15.092+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-9] h.f.e.gateway.client.MicroserviceClient  : 2PC: Preparing payment at: http://localhost:8084/api/payments/prepare
2026-01-27T16:06:15.117+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-9] h.f.e.gateway.client.MicroserviceClient  : 2PC: Payment prepared with ID: 49
2026-01-27T16:06:15.117+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-9] h.f.e.g.service.TwoPhaseCommitService    : Payment prepared: ID=49, status=PRE_AUTHORIZED
2026-01-27T16:06:15.117+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-9] h.f.e.g.service.TwoPhaseCommitService    : Reserving shipment capacity
2026-01-27T16:06:15.117+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-9] h.f.e.gateway.client.MicroserviceClient  : 2PC: Preparing shipment at: http://localhost:8083/api/shipments/prepare
2026-01-27T16:06:15.149+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-9] h.f.e.gateway.client.MicroserviceClient  : 2PC: Shipment prepared with ID: 45
2026-01-27T16:06:15.150+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-9] h.f.e.g.service.TwoPhaseCommitService    : Shipment prepared: ID=45, status=RESERVED
2026-01-27T16:06:15.150+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-9] h.f.e.g.service.TwoPhaseCommitService    : Prepare phase completed - all resources reserved
2026-01-27T16:06:15.151+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-9] h.f.e.g.service.TwoPhaseCommitService    : All participants voted READY
2026-01-27T16:06:15.151+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-9] h.f.e.g.service.TwoPhaseCommitService    : PHASE 2: COMMIT
2026-01-27T16:06:15.151+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-9] h.f.e.g.service.TwoPhaseCommitService    : Committing order
2026-01-27T16:06:15.152+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-9] h.f.e.gateway.client.MicroserviceClient  : 2PC: Committing order at: http://localhost:8082/api/orders/20/commit
2026-01-27T16:06:15.168+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-9] h.f.e.gateway.client.MicroserviceClient  : 2PC: Order committed - ID: 20
2026-01-27T16:06:15.168+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-9] h.f.e.g.service.TwoPhaseCommitService    : Order committed: ID=20
2026-01-27T16:06:15.168+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-9] h.f.e.g.service.TwoPhaseCommitService    : Committing payment
2026-01-27T16:06:15.168+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-9] h.f.e.gateway.client.MicroserviceClient  : 2PC: Committing payment at: http://localhost:8084/api/payments/49/commit
2026-01-27T16:06:15.175+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-9] h.f.e.gateway.client.MicroserviceClient  : 2PC: Payment committed - ID: 49
2026-01-27T16:06:15.183+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-9] h.f.e.g.service.TwoPhaseCommitService    : Payment committed: ID=49
2026-01-27T16:06:15.183+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-9] h.f.e.g.service.TwoPhaseCommitService    : Committing shipment
2026-01-27T16:06:15.184+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-9] h.f.e.gateway.client.MicroserviceClient  : 2PC: Committing shipment at: http://localhost:8083/api/shipments/45/commit
2026-01-27T16:06:15.201+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-9] h.f.e.gateway.client.MicroserviceClient  : 2PC: Shipment committed - ID: 45
2026-01-27T16:06:15.201+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-9] h.f.e.g.service.TwoPhaseCommitService    : Shipment committed: ID=45
2026-01-27T16:06:15.201+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-9] h.f.e.g.service.TwoPhaseCommitService    : Commit phase completed
2026-01-27T16:06:15.201+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-9] h.f.e.g.service.TwoPhaseCommitService    : 2PC completed successfully - Order ID: 20
2026-01-27T16:06:15.201+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-9] h.f.e.g.controller.GatewayController     : GATEWAY | 2PC | totalDuration=170 ms | success=true
2026-01-27T16:06:16.047+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-10] h.f.e.g.controller.GatewayController     : Received 2PC place order request for customer: john.doe@example.com
2026-01-27T16:06:16.047+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-10] h.f.e.g.service.TwoPhaseCommitService    : Starting 2PC for customer: john.doe@example.com
2026-01-27T16:06:16.054+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-10] h.f.e.g.service.TwoPhaseCommitService    : PHASE 1: PREPARE
2026-01-27T16:06:16.054+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-10] h.f.e.g.service.TwoPhaseCommitService    : Preparing order and reserving stock
2026-01-27T16:06:16.054+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-10] h.f.e.gateway.client.MicroserviceClient  : 2PC: Preparing order at: http://localhost:8082/api/orders/prepare
2026-01-27T16:06:16.103+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-10] h.f.e.gateway.client.MicroserviceClient  : 2PC: Order prepared with ID: 21
2026-01-27T16:06:16.103+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-10] h.f.e.g.service.TwoPhaseCommitService    : Order prepared: ID=21, status=PREPARED
2026-01-27T16:06:16.103+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-10] h.f.e.g.service.TwoPhaseCommitService    : Pre-authorizing payment
2026-01-27T16:06:16.103+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-10] h.f.e.gateway.client.MicroserviceClient  : 2PC: Preparing payment at: http://localhost:8084/api/payments/prepare
2026-01-27T16:06:16.135+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-10] h.f.e.gateway.client.MicroserviceClient  : 2PC: Payment prepared with ID: 50
2026-01-27T16:06:16.137+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-10] h.f.e.g.service.TwoPhaseCommitService    : Payment prepared: ID=50, status=PRE_AUTHORIZED
2026-01-27T16:06:16.137+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-10] h.f.e.g.service.TwoPhaseCommitService    : Reserving shipment capacity
2026-01-27T16:06:16.137+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-10] h.f.e.gateway.client.MicroserviceClient  : 2PC: Preparing shipment at: http://localhost:8083/api/shipments/prepare
2026-01-27T16:06:16.178+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-10] h.f.e.gateway.client.MicroserviceClient  : 2PC: Shipment prepared with ID: 46
2026-01-27T16:06:16.179+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-10] h.f.e.g.service.TwoPhaseCommitService    : Shipment prepared: ID=46, status=RESERVED
2026-01-27T16:06:16.179+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-10] h.f.e.g.service.TwoPhaseCommitService    : Prepare phase completed - all resources reserved
2026-01-27T16:06:16.179+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-10] h.f.e.g.service.TwoPhaseCommitService    : All participants voted READY
2026-01-27T16:06:16.179+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-10] h.f.e.g.service.TwoPhaseCommitService    : PHASE 2: COMMIT
2026-01-27T16:06:16.179+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-10] h.f.e.g.service.TwoPhaseCommitService    : Committing order
2026-01-27T16:06:16.179+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-10] h.f.e.gateway.client.MicroserviceClient  : 2PC: Committing order at: http://localhost:8082/api/orders/21/commit
2026-01-27T16:06:16.199+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-10] h.f.e.gateway.client.MicroserviceClient  : 2PC: Order committed - ID: 21
2026-01-27T16:06:16.199+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-10] h.f.e.g.service.TwoPhaseCommitService    : Order committed: ID=21
2026-01-27T16:06:16.199+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-10] h.f.e.g.service.TwoPhaseCommitService    : Committing payment
2026-01-27T16:06:16.199+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-10] h.f.e.gateway.client.MicroserviceClient  : 2PC: Committing payment at: http://localhost:8084/api/payments/50/commit
2026-01-27T16:06:16.222+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-10] h.f.e.gateway.client.MicroserviceClient  : 2PC: Payment committed - ID: 50
2026-01-27T16:06:16.222+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-10] h.f.e.g.service.TwoPhaseCommitService    : Payment committed: ID=50
2026-01-27T16:06:16.223+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-10] h.f.e.g.service.TwoPhaseCommitService    : Committing shipment
2026-01-27T16:06:16.223+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-10] h.f.e.gateway.client.MicroserviceClient  : 2PC: Committing shipment at: http://localhost:8083/api/shipments/46/commit
2026-01-27T16:06:16.245+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-10] h.f.e.gateway.client.MicroserviceClient  : 2PC: Shipment committed - ID: 46
2026-01-27T16:06:16.245+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-10] h.f.e.g.service.TwoPhaseCommitService    : Shipment committed: ID=46
2026-01-27T16:06:16.245+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-10] h.f.e.g.service.TwoPhaseCommitService    : Commit phase completed
2026-01-27T16:06:16.245+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-10] h.f.e.g.service.TwoPhaseCommitService    : 2PC completed successfully - Order ID: 21
2026-01-27T16:06:16.245+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-10] h.f.e.g.controller.GatewayController     : GATEWAY | 2PC | totalDuration=198 ms | success=true
2026-01-27T16:06:17.088+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-1] h.f.e.g.controller.GatewayController     : Received 2PC place order request for customer: john.doe@example.com
2026-01-27T16:06:17.090+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-1] h.f.e.g.service.TwoPhaseCommitService    : Starting 2PC for customer: john.doe@example.com
2026-01-27T16:06:17.095+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-1] h.f.e.g.service.TwoPhaseCommitService    : PHASE 1: PREPARE
2026-01-27T16:06:17.096+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-1] h.f.e.g.service.TwoPhaseCommitService    : Preparing order and reserving stock
2026-01-27T16:06:17.097+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-1] h.f.e.gateway.client.MicroserviceClient  : 2PC: Preparing order at: http://localhost:8082/api/orders/prepare
2026-01-27T16:06:17.144+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-1] h.f.e.gateway.client.MicroserviceClient  : 2PC: Order prepared with ID: 22
2026-01-27T16:06:17.144+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-1] h.f.e.g.service.TwoPhaseCommitService    : Order prepared: ID=22, status=PREPARED
2026-01-27T16:06:17.144+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-1] h.f.e.g.service.TwoPhaseCommitService    : Pre-authorizing payment
2026-01-27T16:06:17.144+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-1] h.f.e.gateway.client.MicroserviceClient  : 2PC: Preparing payment at: http://localhost:8084/api/payments/prepare
2026-01-27T16:06:17.172+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-1] h.f.e.gateway.client.MicroserviceClient  : 2PC: Payment prepared with ID: 51
2026-01-27T16:06:17.172+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-1] h.f.e.g.service.TwoPhaseCommitService    : Payment prepared: ID=51, status=PRE_AUTHORIZED
2026-01-27T16:06:17.172+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-1] h.f.e.g.service.TwoPhaseCommitService    : Reserving shipment capacity
2026-01-27T16:06:17.172+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-1] h.f.e.gateway.client.MicroserviceClient  : 2PC: Preparing shipment at: http://localhost:8083/api/shipments/prepare
2026-01-27T16:06:17.202+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-1] h.f.e.gateway.client.MicroserviceClient  : 2PC: Shipment prepared with ID: 47
2026-01-27T16:06:17.203+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-1] h.f.e.g.service.TwoPhaseCommitService    : Shipment prepared: ID=47, status=RESERVED
2026-01-27T16:06:17.205+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-1] h.f.e.g.service.TwoPhaseCommitService    : Prepare phase completed - all resources reserved
2026-01-27T16:06:17.206+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-1] h.f.e.g.service.TwoPhaseCommitService    : All participants voted READY
2026-01-27T16:06:17.206+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-1] h.f.e.g.service.TwoPhaseCommitService    : PHASE 2: COMMIT
2026-01-27T16:06:17.206+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-1] h.f.e.g.service.TwoPhaseCommitService    : Committing order
2026-01-27T16:06:17.207+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-1] h.f.e.gateway.client.MicroserviceClient  : 2PC: Committing order at: http://localhost:8082/api/orders/22/commit
2026-01-27T16:06:17.220+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-1] h.f.e.gateway.client.MicroserviceClient  : 2PC: Order committed - ID: 22
2026-01-27T16:06:17.220+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-1] h.f.e.g.service.TwoPhaseCommitService    : Order committed: ID=22
2026-01-27T16:06:17.220+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-1] h.f.e.g.service.TwoPhaseCommitService    : Committing payment
2026-01-27T16:06:17.220+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-1] h.f.e.gateway.client.MicroserviceClient  : 2PC: Committing payment at: http://localhost:8084/api/payments/51/commit
2026-01-27T16:06:17.244+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-1] h.f.e.gateway.client.MicroserviceClient  : 2PC: Payment committed - ID: 51
2026-01-27T16:06:17.244+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-1] h.f.e.g.service.TwoPhaseCommitService    : Payment committed: ID=51
2026-01-27T16:06:17.244+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-1] h.f.e.g.service.TwoPhaseCommitService    : Committing shipment
2026-01-27T16:06:17.244+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-1] h.f.e.gateway.client.MicroserviceClient  : 2PC: Committing shipment at: http://localhost:8083/api/shipments/47/commit
2026-01-27T16:06:17.253+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-1] h.f.e.gateway.client.MicroserviceClient  : 2PC: Shipment committed - ID: 47
2026-01-27T16:06:17.253+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-1] h.f.e.g.service.TwoPhaseCommitService    : Shipment committed: ID=47
2026-01-27T16:06:17.261+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-1] h.f.e.g.service.TwoPhaseCommitService    : Commit phase completed
2026-01-27T16:06:17.261+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-1] h.f.e.g.service.TwoPhaseCommitService    : 2PC completed successfully - Order ID: 22
2026-01-27T16:06:17.261+01:00  INFO 7724 --- [Api Gateway] [http-nio-8080-exec-1] h.f.e.g.controller.GatewayController     : GATEWAY | 2PC | totalDuration=172 ms | success=true
2026-01-27T16:44:27.070+01:00  INFO 7724 --- [Api Gateway] [SpringApplicationShutdownHook] o.s.b.w.e.tomcat.GracefulShutdown        : Commencing graceful shutdown. Waiting for active requests to complete
2026-01-27T16:44:27.172+01:00  INFO 7724 --- [Api Gateway] [tomcat-shutdown] o.s.b.w.e.tomcat.GracefulShutdown        : Graceful shutdown complete
2026-01-27T16:44:27.348+01:00  INFO 7724 --- [Api Gateway] [SpringApplicationShutdownHook] j.LocalContainerEntityManagerFactoryBean : Closing JPA EntityManagerFactory for persistence unit 'default'
2026-01-27T16:44:27.402+01:00  WARN 7724 --- [Api Gateway] [SpringApplicationShutdownHook] o.s.b.f.support.DisposableBeanAdapter    : Invocation of destroy method failed on bean with name 'inMemoryDatabaseShutdownExecutor': org.h2.jdbc.JdbcSQLNonTransientConnectionException: Database is already closed (to disable automatic closing at VM shutdown, add ";DB_CLOSE_ON_EXIT=FALSE" to the db URL) [90121-232]
2026-01-27T16:44:27.402+01:00  INFO 7724 --- [Api Gateway] [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown initiated...
2026-01-27T16:44:27.406+01:00  INFO 7724 --- [Api Gateway] [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown completed.
2026-01-27T16:44:38.234+01:00  INFO 13132 --- [Api Gateway] [restartedMain] h.f.e.gateway.ApiGatewayApplication      : Starting ApiGatewayApplication using Java 21.0.8 with PID 13132 (C:\DiplProj\ecommerce-microservices-project\gateway\target\classes started by K76 in C:\DiplProj\ecommerce-microservices-project\gateway)
2026-01-27T16:44:38.234+01:00  INFO 13132 --- [Api Gateway] [restartedMain] h.f.e.gateway.ApiGatewayApplication      : No active profile set, falling back to 1 default profile: "default"
2026-01-27T16:44:38.355+01:00  INFO 13132 --- [Api Gateway] [restartedMain] .e.DevToolsPropertyDefaultsPostProcessor : Devtools property defaults active! Set 'spring.devtools.add-properties' to 'false' to disable
2026-01-27T16:44:38.355+01:00  INFO 13132 --- [Api Gateway] [restartedMain] .e.DevToolsPropertyDefaultsPostProcessor : For additional web related logging consider setting the 'logging.level.web' property to 'DEBUG'
2026-01-27T16:44:39.351+01:00  INFO 13132 --- [Api Gateway] [restartedMain] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2026-01-27T16:44:39.391+01:00  INFO 13132 --- [Api Gateway] [restartedMain] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 20 ms. Found 0 JPA repository interfaces.
2026-01-27T16:44:40.608+01:00  INFO 13132 --- [Api Gateway] [restartedMain] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port 8080 (http)
2026-01-27T16:44:40.637+01:00  INFO 13132 --- [Api Gateway] [restartedMain] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2026-01-27T16:44:40.637+01:00  INFO 13132 --- [Api Gateway] [restartedMain] o.apache.catalina.core.StandardEngine    : Starting Servlet engine: [Apache Tomcat/10.1.48]
2026-01-27T16:44:40.774+01:00  INFO 13132 --- [Api Gateway] [restartedMain] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2026-01-27T16:44:40.775+01:00  INFO 13132 --- [Api Gateway] [restartedMain] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 2417 ms
2026-01-27T16:44:41.300+01:00  INFO 13132 --- [Api Gateway] [restartedMain] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Starting...
2026-01-27T16:44:41.576+01:00  INFO 13132 --- [Api Gateway] [restartedMain] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Added connection conn0: url=jdbc:h2:mem:5e88f6ed-2a0a-40ee-9ae1-a5f220e3a799 user=SA
2026-01-27T16:44:41.576+01:00  INFO 13132 --- [Api Gateway] [restartedMain] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Start completed.
2026-01-27T16:44:41.635+01:00  INFO 13132 --- [Api Gateway] [restartedMain] org.flywaydb.core.FlywayExecutor         : Database: jdbc:h2:mem:5e88f6ed-2a0a-40ee-9ae1-a5f220e3a799 (H2 2.3)
2026-01-27T16:44:41.655+01:00  INFO 13132 --- [Api Gateway] [restartedMain] o.f.c.i.s.JdbcTableSchemaHistory         : Schema history table "PUBLIC"."flyway_schema_history" does not exist yet
2026-01-27T16:44:41.655+01:00  INFO 13132 --- [Api Gateway] [restartedMain] o.f.core.internal.command.DbValidate     : Successfully validated 0 migrations (execution time 00:00.011s)
2026-01-27T16:44:41.655+01:00  WARN 13132 --- [Api Gateway] [restartedMain] o.f.core.internal.command.DbValidate     : No migrations found. Are your locations set up correctly?
2026-01-27T16:44:41.671+01:00  INFO 13132 --- [Api Gateway] [restartedMain] o.f.c.i.s.JdbcTableSchemaHistory         : Creating Schema History table "PUBLIC"."flyway_schema_history" ...
2026-01-27T16:44:41.702+01:00  INFO 13132 --- [Api Gateway] [restartedMain] o.f.core.internal.command.DbMigrate      : Current version of schema "PUBLIC": << Empty Schema >>
2026-01-27T16:44:41.720+01:00  INFO 13132 --- [Api Gateway] [restartedMain] o.f.core.internal.command.DbMigrate      : Schema "PUBLIC" is up to date. No migration necessary.
2026-01-27T16:44:41.810+01:00  INFO 13132 --- [Api Gateway] [restartedMain] o.hibernate.jpa.internal.util.LogHelper  : HHH000204: Processing PersistenceUnitInfo [name: default]
2026-01-27T16:44:41.902+01:00  INFO 13132 --- [Api Gateway] [restartedMain] org.hibernate.Version                    : HHH000412: Hibernate ORM core version 6.6.33.Final
2026-01-27T16:44:41.956+01:00  INFO 13132 --- [Api Gateway] [restartedMain] o.h.c.internal.RegionFactoryInitiator    : HHH000026: Second-level cache disabled
2026-01-27T16:44:42.451+01:00  INFO 13132 --- [Api Gateway] [restartedMain] o.s.o.j.p.SpringPersistenceUnitInfo      : No LoadTimeWeaver setup: ignoring JPA class transformer
2026-01-27T16:44:42.539+01:00  INFO 13132 --- [Api Gateway] [restartedMain] org.hibernate.orm.connections.pooling    : HHH10001005: Database info:
	Database JDBC URL [Connecting through datasource 'HikariDataSource (HikariPool-1)']
	Database driver: undefined/unknown
	Database version: 2.3.232
	Autocommit mode: undefined/unknown
	Isolation level: undefined/unknown
	Minimum pool size: undefined/unknown
	Maximum pool size: undefined/unknown
2026-01-27T16:44:42.888+01:00  INFO 13132 --- [Api Gateway] [restartedMain] o.h.e.t.j.p.i.JtaPlatformInitiator       : HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2026-01-27T16:44:42.904+01:00  INFO 13132 --- [Api Gateway] [restartedMain] j.LocalContainerEntityManagerFactoryBean : Initialized JPA EntityManagerFactory for persistence unit 'default'
2026-01-27T16:44:43.093+01:00  WARN 13132 --- [Api Gateway] [restartedMain] JpaBaseConfiguration$JpaWebConfiguration : spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2026-01-27T16:44:43.539+01:00  INFO 13132 --- [Api Gateway] [restartedMain] o.s.b.a.h2.H2ConsoleAutoConfiguration    : H2 console available at '/h2-console'. Database available at 'jdbc:h2:mem:5e88f6ed-2a0a-40ee-9ae1-a5f220e3a799'
2026-01-27T16:44:43.667+01:00  INFO 13132 --- [Api Gateway] [restartedMain] o.s.b.d.a.OptionalLiveReloadServer       : LiveReload server is running on port 35729
2026-01-27T16:44:43.795+01:00  INFO 13132 --- [Api Gateway] [restartedMain] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port 8080 (http) with context path '/'
2026-01-27T16:44:43.811+01:00  INFO 13132 --- [Api Gateway] [restartedMain] h.f.e.gateway.ApiGatewayApplication      : Started ApiGatewayApplication in 6.131 seconds (process running for 6.851)
2026-01-27T16:45:23.623+01:00  INFO 13132 --- [Api Gateway] [http-nio-8080-exec-1] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring DispatcherServlet 'dispatcherServlet'
2026-01-27T16:45:23.631+01:00  INFO 13132 --- [Api Gateway] [http-nio-8080-exec-1] o.s.web.servlet.DispatcherServlet        : Initializing Servlet 'dispatcherServlet'
2026-01-27T16:45:23.640+01:00  INFO 13132 --- [Api Gateway] [http-nio-8080-exec-1] o.s.web.servlet.DispatcherServlet        : Completed initialization in 8 ms
2026-01-27T16:45:23.841+01:00  INFO 13132 --- [Api Gateway] [http-nio-8080-exec-1] h.f.e.g.controller.GatewayController     : Received place order request for customer: john.doe@example.com
2026-01-27T16:45:23.841+01:00  INFO 13132 --- [Api Gateway] [http-nio-8080-exec-1] h.f.e.gateway.service.SagaService        : Starting order placement for customer: john.doe@example.com
2026-01-27T16:45:23.841+01:00  INFO 13132 --- [Api Gateway] [http-nio-8080-exec-1] h.f.e.gateway.service.SagaService        : Step 1: Creating order...
2026-01-27T16:45:23.858+01:00  INFO 13132 --- [Api Gateway] [http-nio-8080-exec-1] h.f.e.gateway.client.MicroserviceClient  : Creating order at: http://localhost:8082/api/orders
2026-01-27T16:45:24.654+01:00  INFO 13132 --- [Api Gateway] [http-nio-8080-exec-1] h.f.e.gateway.client.MicroserviceClient  : Order created successfully with ID: 6
2026-01-27T16:45:24.654+01:00  INFO 13132 --- [Api Gateway] [http-nio-8080-exec-1] h.f.e.gateway.service.SagaService        : Order created with ID: 6
2026-01-27T16:45:24.670+01:00  INFO 13132 --- [Api Gateway] [http-nio-8080-exec-1] h.f.e.gateway.service.SagaService        : Step 2: Processing payment...
2026-01-27T16:45:24.670+01:00  INFO 13132 --- [Api Gateway] [http-nio-8080-exec-1] h.f.e.gateway.client.MicroserviceClient  : Creating payment at: http://localhost:8084/api/payments
2026-01-27T16:45:25.019+01:00  INFO 13132 --- [Api Gateway] [http-nio-8080-exec-1] h.f.e.gateway.client.MicroserviceClient  : Payment created successfully with ID: 6
2026-01-27T16:45:25.019+01:00  INFO 13132 --- [Api Gateway] [http-nio-8080-exec-1] h.f.e.gateway.service.SagaService        : Payment created with ID: 6 and transaction ID: TXN-7a130d25-3fd7-429c-b9b5-c444f4c4a1e1
2026-01-27T16:45:25.019+01:00  INFO 13132 --- [Api Gateway] [http-nio-8080-exec-1] h.f.e.gateway.service.SagaService        : Step 3: Creating shipment...
2026-01-27T16:45:25.019+01:00  INFO 13132 --- [Api Gateway] [http-nio-8080-exec-1] h.f.e.gateway.client.MicroserviceClient  : Creating shipment at: http://localhost:8083/api/shipments
2026-01-27T16:45:25.795+01:00  INFO 13132 --- [Api Gateway] [http-nio-8080-exec-1] h.f.e.gateway.client.MicroserviceClient  : Shipment created successfully with ID: 6
2026-01-27T16:45:25.795+01:00  INFO 13132 --- [Api Gateway] [http-nio-8080-exec-1] h.f.e.gateway.service.SagaService        : Shipment created with ID: 6
2026-01-27T16:45:25.795+01:00  INFO 13132 --- [Api Gateway] [http-nio-8080-exec-1] h.f.e.gateway.service.SagaService        : Order placement completed successfully for order ID: 6
2026-01-27T16:45:25.795+01:00  INFO 13132 --- [Api Gateway] [http-nio-8080-exec-1] h.f.e.g.controller.GatewayController     : GATEWAY | SAGA | totalDuration=1950 ms | success=true
2026-01-27T16:45:28.633+01:00  INFO 13132 --- [Api Gateway] [http-nio-8080-exec-2] h.f.e.g.controller.GatewayController     : Received 2PC place order request for customer: john.doe@example.com
2026-01-27T16:45:28.633+01:00  INFO 13132 --- [Api Gateway] [http-nio-8080-exec-2] h.f.e.g.service.TwoPhaseCommitService    : Starting 2PC for customer: john.doe@example.com
2026-01-27T16:45:28.633+01:00  INFO 13132 --- [Api Gateway] [http-nio-8080-exec-2] h.f.e.g.service.TwoPhaseCommitService    : PHASE 1: PREPARE
2026-01-27T16:45:28.633+01:00  INFO 13132 --- [Api Gateway] [http-nio-8080-exec-2] h.f.e.g.service.TwoPhaseCommitService    : Preparing order and reserving stock
2026-01-27T16:45:28.641+01:00  INFO 13132 --- [Api Gateway] [http-nio-8080-exec-2] h.f.e.gateway.client.MicroserviceClient  : 2PC: Preparing order at: http://localhost:8082/api/orders/prepare
2026-01-27T16:45:28.707+01:00  INFO 13132 --- [Api Gateway] [http-nio-8080-exec-2] h.f.e.gateway.client.MicroserviceClient  : 2PC: Order prepared with ID: 7
2026-01-27T16:45:28.709+01:00  INFO 13132 --- [Api Gateway] [http-nio-8080-exec-2] h.f.e.g.service.TwoPhaseCommitService    : Order prepared: ID=7, status=PREPARED
2026-01-27T16:45:28.711+01:00  INFO 13132 --- [Api Gateway] [http-nio-8080-exec-2] h.f.e.g.service.TwoPhaseCommitService    : Pre-authorizing payment
2026-01-27T16:45:28.712+01:00  INFO 13132 --- [Api Gateway] [http-nio-8080-exec-2] h.f.e.gateway.client.MicroserviceClient  : 2PC: Preparing payment at: http://localhost:8084/api/payments/prepare
2026-01-27T16:45:28.750+01:00  INFO 13132 --- [Api Gateway] [http-nio-8080-exec-2] h.f.e.gateway.client.MicroserviceClient  : 2PC: Payment prepared with ID: 7
2026-01-27T16:45:28.750+01:00  INFO 13132 --- [Api Gateway] [http-nio-8080-exec-2] h.f.e.g.service.TwoPhaseCommitService    : Payment prepared: ID=7, status=PRE_AUTHORIZED
2026-01-27T16:45:28.750+01:00  INFO 13132 --- [Api Gateway] [http-nio-8080-exec-2] h.f.e.g.service.TwoPhaseCommitService    : Reserving shipment capacity
2026-01-27T16:45:28.750+01:00  INFO 13132 --- [Api Gateway] [http-nio-8080-exec-2] h.f.e.gateway.client.MicroserviceClient  : 2PC: Preparing shipment at: http://localhost:8083/api/shipments/prepare
2026-01-27T16:45:28.791+01:00  INFO 13132 --- [Api Gateway] [http-nio-8080-exec-2] h.f.e.gateway.client.MicroserviceClient  : 2PC: Shipment prepared with ID: 7
2026-01-27T16:45:28.800+01:00  INFO 13132 --- [Api Gateway] [http-nio-8080-exec-2] h.f.e.g.service.TwoPhaseCommitService    : Shipment prepared: ID=7, status=RESERVED
2026-01-27T16:45:28.801+01:00  INFO 13132 --- [Api Gateway] [http-nio-8080-exec-2] h.f.e.g.service.TwoPhaseCommitService    : Prepare phase completed - all resources reserved
2026-01-27T16:45:28.802+01:00  INFO 13132 --- [Api Gateway] [http-nio-8080-exec-2] h.f.e.g.service.TwoPhaseCommitService    : All participants voted READY
2026-01-27T16:45:28.802+01:00  INFO 13132 --- [Api Gateway] [http-nio-8080-exec-2] h.f.e.g.service.TwoPhaseCommitService    : PHASE 2: COMMIT
2026-01-27T16:45:28.802+01:00  INFO 13132 --- [Api Gateway] [http-nio-8080-exec-2] h.f.e.g.service.TwoPhaseCommitService    : Committing order
2026-01-27T16:45:28.803+01:00  INFO 13132 --- [Api Gateway] [http-nio-8080-exec-2] h.f.e.gateway.client.MicroserviceClient  : 2PC: Committing order at: http://localhost:8082/api/orders/7/commit
2026-01-27T16:45:28.841+01:00  INFO 13132 --- [Api Gateway] [http-nio-8080-exec-2] h.f.e.gateway.client.MicroserviceClient  : 2PC: Order committed - ID: 7
2026-01-27T16:45:28.841+01:00  INFO 13132 --- [Api Gateway] [http-nio-8080-exec-2] h.f.e.g.service.TwoPhaseCommitService    : Order committed: ID=7
2026-01-27T16:45:28.841+01:00  INFO 13132 --- [Api Gateway] [http-nio-8080-exec-2] h.f.e.g.service.TwoPhaseCommitService    : Committing payment
2026-01-27T16:45:28.841+01:00  INFO 13132 --- [Api Gateway] [http-nio-8080-exec-2] h.f.e.gateway.client.MicroserviceClient  : 2PC: Committing payment at: http://localhost:8084/api/payments/7/commit
2026-01-27T16:45:28.896+01:00  INFO 13132 --- [Api Gateway] [http-nio-8080-exec-2] h.f.e.gateway.client.MicroserviceClient  : 2PC: Payment committed - ID: 7
2026-01-27T16:45:28.896+01:00  INFO 13132 --- [Api Gateway] [http-nio-8080-exec-2] h.f.e.g.service.TwoPhaseCommitService    : Payment committed: ID=7
2026-01-27T16:45:28.901+01:00  INFO 13132 --- [Api Gateway] [http-nio-8080-exec-2] h.f.e.g.service.TwoPhaseCommitService    : Committing shipment
2026-01-27T16:45:28.909+01:00  INFO 13132 --- [Api Gateway] [http-nio-8080-exec-2] h.f.e.gateway.client.MicroserviceClient  : 2PC: Committing shipment at: http://localhost:8083/api/shipments/7/commit
2026-01-27T16:45:29.045+01:00  INFO 13132 --- [Api Gateway] [http-nio-8080-exec-2] h.f.e.gateway.client.MicroserviceClient  : 2PC: Shipment committed - ID: 7
2026-01-27T16:45:29.045+01:00  INFO 13132 --- [Api Gateway] [http-nio-8080-exec-2] h.f.e.g.service.TwoPhaseCommitService    : Shipment committed: ID=7
2026-01-27T16:45:29.049+01:00  INFO 13132 --- [Api Gateway] [http-nio-8080-exec-2] h.f.e.g.service.TwoPhaseCommitService    : Commit phase completed
2026-01-27T16:45:29.049+01:00  INFO 13132 --- [Api Gateway] [http-nio-8080-exec-2] h.f.e.g.service.TwoPhaseCommitService    : 2PC completed successfully - Order ID: 7
2026-01-27T16:45:29.049+01:00  INFO 13132 --- [Api Gateway] [http-nio-8080-exec-2] h.f.e.g.controller.GatewayController     : GATEWAY | 2PC | totalDuration=418 ms | success=true
2026-01-27T16:45:30.260+01:00  INFO 13132 --- [Api Gateway] [http-nio-8080-exec-3] h.f.e.g.controller.GatewayController     : Received place order request for customer: john.doe@example.com
2026-01-27T16:45:30.260+01:00  INFO 13132 --- [Api Gateway] [http-nio-8080-exec-3] h.f.e.gateway.service.SagaService        : Starting order placement for customer: john.doe@example.com
2026-01-27T16:45:30.267+01:00  INFO 13132 --- [Api Gateway] [http-nio-8080-exec-3] h.f.e.gateway.service.SagaService        : Step 1: Creating order...
2026-01-27T16:45:30.267+01:00  INFO 13132 --- [Api Gateway] [http-nio-8080-exec-3] h.f.e.gateway.client.MicroserviceClient  : Creating order at: http://localhost:8082/api/orders
2026-01-27T16:45:30.425+01:00  INFO 13132 --- [Api Gateway] [http-nio-8080-exec-3] h.f.e.gateway.client.MicroserviceClient  : Order created successfully with ID: 8
2026-01-27T16:45:30.425+01:00  INFO 13132 --- [Api Gateway] [http-nio-8080-exec-3] h.f.e.gateway.service.SagaService        : Order created with ID: 8
2026-01-27T16:45:30.425+01:00  INFO 13132 --- [Api Gateway] [http-nio-8080-exec-3] h.f.e.gateway.service.SagaService        : Step 2: Processing payment...
2026-01-27T16:45:30.425+01:00  INFO 13132 --- [Api Gateway] [http-nio-8080-exec-3] h.f.e.gateway.client.MicroserviceClient  : Creating payment at: http://localhost:8084/api/payments
2026-01-27T16:45:30.499+01:00  INFO 13132 --- [Api Gateway] [http-nio-8080-exec-3] h.f.e.gateway.client.MicroserviceClient  : Payment created successfully with ID: 8
2026-01-27T16:45:30.499+01:00  INFO 13132 --- [Api Gateway] [http-nio-8080-exec-3] h.f.e.gateway.service.SagaService        : Payment created with ID: 8 and transaction ID: TXN-b422917d-9ef4-4a83-8b77-b624c7f78b2c
2026-01-27T16:45:30.499+01:00  INFO 13132 --- [Api Gateway] [http-nio-8080-exec-3] h.f.e.gateway.service.SagaService        : Step 3: Creating shipment...
2026-01-27T16:45:30.499+01:00  INFO 13132 --- [Api Gateway] [http-nio-8080-exec-3] h.f.e.gateway.client.MicroserviceClient  : Creating shipment at: http://localhost:8083/api/shipments
2026-01-27T16:45:30.522+01:00  INFO 13132 --- [Api Gateway] [http-nio-8080-exec-3] h.f.e.gateway.client.MicroserviceClient  : Shipment created successfully with ID: 8
2026-01-27T16:45:30.522+01:00  INFO 13132 --- [Api Gateway] [http-nio-8080-exec-3] h.f.e.gateway.service.SagaService        : Shipment created with ID: 8
2026-01-27T16:45:30.522+01:00  INFO 13132 --- [Api Gateway] [http-nio-8080-exec-3] h.f.e.gateway.service.SagaService        : Order placement completed successfully for order ID: 8
2026-01-27T16:45:30.522+01:00  INFO 13132 --- [Api Gateway] [http-nio-8080-exec-3] h.f.e.g.controller.GatewayController     : GATEWAY | SAGA | totalDuration=266 ms | success=true
2026-01-27T16:53:17.276+01:00  INFO 13132 --- [Api Gateway] [SpringApplicationShutdownHook] o.s.b.w.e.tomcat.GracefulShutdown        : Commencing graceful shutdown. Waiting for active requests to complete
2026-01-27T16:53:17.291+01:00  INFO 13132 --- [Api Gateway] [tomcat-shutdown] o.s.b.w.e.tomcat.GracefulShutdown        : Graceful shutdown complete
2026-01-27T16:53:17.345+01:00  INFO 13132 --- [Api Gateway] [SpringApplicationShutdownHook] j.LocalContainerEntityManagerFactoryBean : Closing JPA EntityManagerFactory for persistence unit 'default'
2026-01-27T16:53:17.360+01:00  WARN 13132 --- [Api Gateway] [SpringApplicationShutdownHook] o.s.b.f.support.DisposableBeanAdapter    : Invocation of destroy method failed on bean with name 'inMemoryDatabaseShutdownExecutor': org.h2.jdbc.JdbcSQLNonTransientConnectionException: Database is already closed (to disable automatic closing at VM shutdown, add ";DB_CLOSE_ON_EXIT=FALSE" to the db URL) [90121-232]
2026-01-27T16:53:17.360+01:00  INFO 13132 --- [Api Gateway] [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown initiated...
2026-01-27T16:53:17.360+01:00  INFO 13132 --- [Api Gateway] [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown completed.
